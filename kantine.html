<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kantine ‚Äî Brandweer Herentals</title>
<link rel="stylesheet" href="/brandweerherentals/kantine.css">
<link rel="manifest" href="/brandweerherentals/manifest.json">
<meta name="theme-color" content="#c71f1f">
</head>
<body>
<div class="container">
  <header>Kantine ‚Äî Bestelling</header>

  <main>
    <div class="product-grid" id="productGrid"></div>

    <div class="cart" id="cartSection">
      <h2>üßæ Jouw bestelling</h2>
      <ul id="cartList"></ul>
      <button id="confirmOrder">Bevestig bestelling</button>
    </div>
  </main>

  <footer>Brandweer Herentals ‚Äî Kantinebeheer</footer>
</div>

<script>
// Apps Script endpoint
const endpoint = "https://script.google.com/macros/s/AKfycbyJ-dqNiQ7Z187DIidfJahBFNB5RQcWFDQdZIxGKyzS3_Xf831SdsRSFyDxPFLQcTE/exec";

// Productenlijst
const producten = [
  { naam: "Pintje", prijs: 1.5, img: "/brandweerherentals/icons/drinks/beer.png" },
  { naam: "Cola", prijs: 1.8, img: "/brandweerherentals/icons/drinks/cola.png" },
  { naam: "Fanta", prijs: 1.8, img: "/brandweerherentals/icons/drinks/fanta.png" },
  { naam: "Water", prijs: 1.0, img: "/brandweerherentals/icons/drinks/water.png" },
  { naam: "Koffie", prijs: 1.2, img: "/brandweerherentals/icons/drinks/coffee.png" },
  { naam: "Chips", prijs: 1.5, img: "/brandweerherentals/icons/drinks/chips.png" }
];

const grid = document.getElementById("productGrid");
const cartList = document.getElementById("cartList");
const confirmBtn = document.getElementById("confirmOrder");
let cart = {};

// Producten tonen
producten.forEach(p => {
  const card = document.createElement("div");
  card.className = "product-card";
  card.innerHTML = `
    <img src="${p.img}" alt="${p.naam}">
    <h3>${p.naam}</h3>
    <p>‚Ç¨${p.prijs.toFixed(2)}</p>
    <div class="controls">
      <button class="minus">‚àí</button>
      <span>0</span>
      <button class="plus">+</button>
    </div>
  `;

  const countEl = card.querySelector("span");
  const minusBtn = card.querySelector(".minus");
  const plusBtn = card.querySelector(".plus");

  plusBtn.onclick = () => { cart[p.naam] = (cart[p.naam]||0)+1; updateCart(); };
  minusBtn.onclick = () => { if(cart[p.naam]) { cart[p.naam]--; if(cart[p.naam]<=0) delete cart[p.naam]; updateCart(); } };

  grid.appendChild(card);
});

// Winkelmandje bijwerken
function updateCart() {
  cartList.innerHTML = "";
  let totaal = 0;
  for (const [naam, aantal] of Object.entries(cart)) {
    const product = producten.find(p => p.naam === naam);
    const subtotaal = product.prijs * aantal;
    totaal += subtotaal;
    const li = document.createElement("li");
    li.textContent = `${aantal} √ó ${naam}`;
    const price = document.createElement("span");
    price.textContent = `‚Ç¨${subtotaal.toFixed(2)}`;
    li.appendChild(price);
    cartList.appendChild(li);
  }

  if (totaal === 0) {
    cartList.innerHTML = "<li>Geen producten geselecteerd.</li>";
    confirmBtn.disabled = true;
  } else {
    const totalLi = document.createElement("li");
    totalLi.innerHTML = `<strong>Totaal</strong><span><strong>‚Ç¨${totaal.toFixed(2)}</strong></span>`;
    cartList.appendChild(totalLi);
    confirmBtn.disabled = false;
  }
}

// Bestelling bevestigen
confirmBtn.addEventListener("click", async () => {
  if (Object.keys(cart).length === 0) return;

  const naam = prompt("Vul je naam in:");
  if (!naam) return alert("Naam is verplicht!");

  const tijd = new Date().toLocaleString("nl-BE");
  const items = Object.entries(cart).map(([product,aantal]) => ({ product, aantal }));

  try {
    const res = await fetch(endpoint, {
      method: "POST",
      body: JSON.stringify({ naam, tijd, items }),
      headers: { "Content-Type": "application/json" }
    });
    const data = await res.json();
    if(data.status === "ok") {
      alert("‚úÖ Bestelling succesvol geregistreerd!");
    } else {
      alert("‚ùå Fout bij registratie: " + data.message);
    }
  } catch(err) {
    alert("‚ùå Kan bestelling niet versturen: " + err);
  }

  // Betaalopties
  const betaal = confirm("Wil je betalen via Payconiq (OK) of Cash (Annuleren)?");
  if(betaal) window.open("https://payconiq.com", "_blank");
  else alert("üí∂ Betaling geregistreerd als contant.");

  // Winkelmandje reset
  cart = {};
  updateCart();
});
</script>
</body>
</html>
