<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kantine ‚Äî Brandweer Herentals</title>
<link rel="stylesheet" href="/brandweerherentals/kantine.css">
<link rel="manifest" href="/brandweerherentals/manifest.json">
<meta name="theme-color" content="#c71f1f">
<style>
/* Extra meldingskadertjes */
.toast {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #c71f1f;
  color: white;
  padding: 12px 20px;
  border-radius: 12px;
  font-weight: 700;
  z-index: 9999;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  display: none;
}
.toast.success { background: #28a745; }
.toast.error { background: #dc3545; }
.toast.info { background: #ffc107; color: #111; }
</style>
</head>
<body>
<div class="container">
  <header>Kantine ‚Äî Bestelling</header>
  <a href="/brandweerherentals/" class="back">‚Üê Terug naar start</a>

  <main>
    <div class="product-grid" id="productGrid"></div>

    <div class="cart" id="cartSection">
      <h2>üßæ Jouw bestelling</h2>
      <ul id="cartList"></ul>
      <button id="confirmOrder">Bevestig bestelling</button>
    </div>
  </main>

  <footer>Brandweer Herentals ‚Äî Kantinebeheer</footer>
</div>

<div class="toast" id="toast"></div>

<script>
// üåê Google Apps Script Web App URL
const webAppUrl = "https://script.google.com/macros/s/AKfycbyJ-dqNiQ7Z187DIidfJahBFNB5RQcWFDQdZIxGKyzS3_Xf831SdsRSFyDxPFLQcTE/exec";

// Productenlijst
const producten = [
  { naam: "Pintje", prijs: 1.5, img: "/brandweerherentals/icons/drinks/beer.png" },
  { naam: "Cola", prijs: 1.8, img: "/brandweerherentals/icons/drinks/cola.png" },
  { naam: "Fanta", prijs: 1.8, img: "/brandweerherentals/icons/drinks/fanta.png" },
  { naam: "Water", prijs: 1.0, img: "/brandweerherentals/icons/drinks/water.png" },
  { naam: "Koffie", prijs: 1.2, img: "/brandweerherentals/icons/drinks/coffee.png" },
  { naam: "Chips", prijs: 1.5, img: "/brandweerherentals/icons/drinks/chips.png" }
];

const grid = document.getElementById("productGrid");
const cartList = document.getElementById("cartList");
const confirmBtn = document.getElementById("confirmOrder");
const toast = document.getElementById("toast");

let cart = {};

// üßÉ Producten tonen
producten.forEach(p => {
  const card = document.createElement("div");
  card.className = "product-card";
  card.innerHTML = `
    <img src="${p.img}" alt="${p.naam}">
    <h3>${p.naam}</h3>
    <p>‚Ç¨${p.prijs.toFixed(2)}</p>
    <div class="controls">
      <button class="minus">‚àí</button>
      <span>0</span>
      <button class="plus">+</button>
    </div>
  `;

  const countEl = card.querySelector("span");
  const minusBtn = card.querySelector(".minus");
  const plusBtn = card.querySelector(".plus");

  plusBtn.onclick = () => { cart[p.naam] = (cart[p.naam] || 0) + 1; updateCart(); };
  minusBtn.onclick = () => { if(cart[p.naam]) { cart[p.naam]--; if(cart[p.naam]<=0) delete cart[p.naam]; updateCart(); } };

  grid.appendChild(card);
});

// üßæ Winkelmandje bijwerken
function updateCart() {
  cartList.innerHTML = "";
  let totaal = 0;
  for (const [naam, aantal] of Object.entries(cart)) {
    const product = producten.find(p => p.naam === naam);
    const subtotaal = product.prijs * aantal;
    totaal += subtotaal;

    const li = document.createElement("li");
    li.textContent = `${aantal} √ó ${naam}`;
    const price = document.createElement("span");
    price.textContent = `‚Ç¨${subtotaal.toFixed(2)}`;
    li.appendChild(price);
    cartList.appendChild(li);
  }

  if(totaal===0) { cartList.innerHTML="<li>Geen producten geselecteerd.</li>"; confirmBtn.disabled=true; }
  else {
    const totalLi = document.createElement("li");
    totalLi.innerHTML = `<strong>Totaal</strong><span><strong>‚Ç¨${totaal.toFixed(2)}</strong></span>`;
    cartList.appendChild(totalLi);
    confirmBtn.disabled=false;
  }
}

// üíæ Toon meldingsbalk
function showToast(message, type="info") {
  toast.textContent = message;
  toast.className = "toast " + type;
  toast.style.display = "block";
  setTimeout(()=>{ toast.style.display="none"; }, 3000);
}

// üíª Bestelling verzenden
confirmBtn.addEventListener("click", async () => {
  if(Object.keys(cart).length===0) return;

  const name = prompt("Vul je naam in:");
  if(!name) { showToast("Naam verplicht!", "error"); return; }

  try {
    // Stuur bestelling naar Google Apps Script
    for(const [product, quantity] of Object.entries(cart)){
      const response = await fetch(webAppUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({name, product, quantity})
      });

      const result = await response.json();
      if(result.status!=="ok") throw new Error(result.message||"Fout bij verzenden");
    }

    // Betaling prompt
    const keuze = confirm("Wil je betalen via Payconiq (OK) of Cash (Annuleren)?");
    if(keuze) showToast("üí≥ Redirect naar Payconiq...", "info");
    else showToast("üí∂ Betaling geregistreerd als contant", "success");

    // Winkelmandje leegmaken
    cart = {};
    updateCart();
  }
  catch(err){
    console.error(err);
    showToast("‚ùå Bestelling niet verzonden: "+err.message, "error");
  }
});
</script>
</body>
</html>

