<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kantine — Brandweer Herentals</title>
<link rel="stylesheet" href="/brandweerherentals/kantine.css">
<meta name="theme-color" content="#c71f1f">
</head>
<body>
<div class="container">
  <header>Kantine — Bestelling</header>
  <main>
    <div class="product-grid" id="productGrid"></div>

    <div class="cart" id="cartSection">
      <h2>🧾 Jouw bestelling</h2>
      <ul id="cartList"></ul>
      <button id="confirmOrder">Bevestig bestelling</button>
    </div>
  </main>
  <footer>Brandweer Herentals — Kantinebeheer</footer>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwAh04hNcIIuAvlP_MnH9kXDPmGxGuYRlR1GlUMUakruBGkISSyr1-rs3o_DsAiXa79/exec"; // ← Apps Script URL

let producten = [];
let cart = {};

const grid = document.getElementById("productGrid");
const cartList = document.getElementById("cartList");
const confirmBtn = document.getElementById("confirmOrder");

// 🌟 Haal producten + stock van Apps Script
fetch(API_URL)
.then(res => res.json())
.then(data => {
  producten = data;
  renderProducts();
});

function renderProducts() {
  grid.innerHTML = "";
  producten.forEach(p => {
    const card = document.createElement("div");
    card.className = "product-card";
    card.innerHTML = `
      <img src="/brandweerherentals/icons/drinks/${p.name.toLowerCase()}.png" alt="${p.name}">
      <h3>${p.name}</h3>
      <p>€1.50</p>
      <div class="controls">
        <button class="minus">−</button>
        <span>0</span>
        <button class="plus">+</button>
      </div>
      <p>Voorraad: ${p.stock}</p>
    `;
    const countEl = card.querySelector("span");
    card.querySelector(".plus").onclick = () => {
      if((cart[p.name]||0) < p.stock) {
        cart[p.name] = (cart[p.name]||0)+1;
        updateCart();
      } else alert("❌ Niet genoeg voorraad!");
    };
    card.querySelector(".minus").onclick = () => {
      if(cart[p.name]) { cart[p.name]--; if(cart[p.name]<=0) delete cart[p.name]; updateCart(); }
    };
    grid.appendChild(card);
  });
}

function updateCart() {
  cartList.innerHTML = "";
  let totaal = 0;
  for(const [name, qty] of Object.entries(cart)){
    const li = document.createElement("li");
    li.textContent = `${qty} × ${name}`;
    cartList.appendChild(li);
    totaal += qty * 1.5;
  }
  if(totaal===0){ confirmBtn.disabled=true; cartList.innerHTML="<li>Geen producten geselecteerd.</li>"; }
  else confirmBtn.disabled=false;
}

// 💾 Bevestig bestelling en stuur naar Apps Script
confirmBtn.onclick = async () => {
  if(Object.keys(cart).length===0) return;

  const naam = prompt("Wat is je naam?");
  for(const [product, quantity] of Object.entries(cart)){
    try{
      const res = await fetch(API_URL, {
        method: "POST",
        body: JSON.stringify({name: naam, product, quantity, paid: "Nee"}),
        headers: {'Content-Type':'application/json'}
      });
      const result = await res.json();
      alert(result.status==="ok" ? `✅ ${quantity}× ${product} toegevoegd!` : `❌ Fout: ${result.message}`);
    } catch(err){
      alert("❌ Kan bestelling niet versturen: "+err.message);
    }
  }

  // Leeg winkelmandje
  cart={};
  updateCart();
};
</script>
</body>
</html>
