<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kantine ‚Äî Brandweer Herentals</title>
<link rel="stylesheet" href="/brandweerherentals/kantine.css">
<link rel="manifest" href="/brandweerherentals/manifest.json">
<meta name="theme-color" content="#c71f1f">
<style>
/* Extra styling voor overlay en totaal */
#cartTotal { text-align:right; font-weight:700; margin:10px 0; font-size:16px; }
.overlay {
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.5);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index: 9999;
}
.overlay-content {
  background:#fff;
  padding:24px;
  border-radius:12px;
  max-width:400px;
  width:90%;
  text-align:center;
}
.overlay-content h2 { margin-top:0; }
.overlay-content button { margin:6px; padding:12px 20px; font-weight:700; border:none; border-radius:8px; cursor:pointer; }
#qrCode { margin-top:12px; }
.back-link { display:block; margin:10px 0; color:#c71f1f; font-weight:700; text-decoration:none; }
</style>
</head>
<body>
<div class="container">
  <header>
    Kantine ‚Äî Bestelling
    <a href="/brandweerherentals/" class="back-link">‚Üê Terug naar start</a>
  </header>

  <main>
    <div class="product-grid" id="productGrid"></div>

    <div class="cart" id="cartSection">
      <h2>üßæ Jouw bestelling</h2>
      <ul id="cartList"></ul>
      <div id="cartTotal"></div>
      <button id="confirmOrder">Bevestig bestelling</button>
    </div>
  </main>

  <footer>Brandweer Herentals ‚Äî Kantinebeheer</footer>
</div>

<!-- Overlay voor betaalkeuze -->
<div id="paymentOverlay" class="overlay" style="display:none;">
  <div class="overlay-content">
    <h2>üí≥ Kies betaalmethode</h2>
    <button id="payPayconiq" style="background:#00b0ff;color:#fff;">Payconiq</button>
    <button id="payCash" style="background:#ffbb00;color:#111;">Cash</button>
    <button id="payTransfer" style="background:#00c853;color:#fff;">Bankoverschrijving</button>
    <div id="qrCode"></div>
    <button id="closeOverlay" style="margin-top:12px;background:#ccc;color:#111;">Sluiten</button>
  </div>
</div>

<script>
// Productenlijst
const producten = [
  { naam: "Pintje", prijs: 1.5, img: "/brandweerherentals/icons/drinks/beer.png" },
  { naam: "Cola", prijs: 1.8, img: "/brandweerherentals/icons/drinks/cola.png" },
  { naam: "Fanta", prijs: 1.8, img: "/brandweerherentals/icons/drinks/fanta.png" },
  { naam: "Water", prijs: 1.0, img: "/brandweerherentals/icons/drinks/water.png" },
  { naam: "Koffie", prijs: 1.2, img: "/brandweerherentals/icons/drinks/coffee.png" },
  { naam: "Chips", prijs: 1.5, img: "/brandweerherentals/icons/drinks/chips.png" }
];

const grid = document.getElementById("productGrid");
const cartList = document.getElementById("cartList");
const cartTotal = document.getElementById("cartTotal");
const confirmBtn = document.getElementById("confirmOrder");

let cart = {};

// üßÉ Producten tonen
producten.forEach(p => {
  const card = document.createElement("div");
  card.className = "product-card";
  card.innerHTML = `
    <img src="${p.img}" alt="${p.naam}">
    <h3>${p.naam}</h3>
    <p>‚Ç¨${p.prijs.toFixed(2)}</p>
    <div class="controls">
      <button class="minus">‚àí</button>
      <span>0</span>
      <button class="plus">+</button>
    </div>
  `;

  const countEl = card.querySelector("span");
  const minusBtn = card.querySelector(".minus");
  const plusBtn = card.querySelector(".plus");

  plusBtn.onclick = () => { cart[p.naam] = (cart[p.naam] || 0) + 1; updateCart(); };
  minusBtn.onclick = () => { if(cart[p.naam]) { cart[p.naam]--; if(cart[p.naam]<=0) delete cart[p.naam]; updateCart(); } };

  grid.appendChild(card);
});

// üßæ Winkelmandje bijwerken
function updateCart() {
  cartList.innerHTML = "";
  let totaal = 0;

  for (const [naam, aantal] of Object.entries(cart)) {
    const product = producten.find(p => p.naam === naam);
    const subtotaal = product.prijs * aantal;
    totaal += subtotaal;

    const li = document.createElement("li");
    li.textContent = `${aantal} √ó ${naam}`;
    const price = document.createElement("span");
    price.textContent = `‚Ç¨${subtotaal.toFixed(2)}`;
    li.appendChild(price);
    cartList.appendChild(li);
  }

  if(totaal===0){
    cartList.innerHTML="<li>Geen producten geselecteerd.</li>";
    cartTotal.textContent="";
    confirmBtn.disabled=true;
  } else {
    const totalLi = document.createElement("li");
    totalLi.innerHTML=`<strong>Totaal</strong><span><strong>‚Ç¨${totaal.toFixed(2)}</strong></span>`;
    cartList.appendChild(totalLi);
    cartTotal.textContent=`Totaal te betalen: ‚Ç¨${totaal.toFixed(2)}`;
    confirmBtn.disabled=false;
  }
}

// üíæ Bestelling bevestigen
confirmBtn.addEventListener("click", () => {
  if(Object.keys(cart).length===0) return;

  // LocalStorage opslaan
  const timestamp = new Date().toLocaleString("nl-BE");
  const bestelling = { tijd: timestamp, items: { ...cart } };
  const bestellingen = JSON.parse(localStorage.getItem("kantine_bestellingen")||"[]");
  bestellingen.push(bestelling);
  localStorage.setItem("kantine_bestellingen", JSON.stringify(bestellingen));

  // Overlay tonen
  document.getElementById("paymentOverlay").style.display="flex";

  // QR-code genereren
  const totaal = Object.entries(cart).reduce((sum,[naam,aantal])=>{
    const p = producten.find(x=>x.naam===naam); return sum+p.prijs*aantal;
  },0);
  const IBAN="BE12345678901234";
  const mededeling="Kantine Brandweer Herentals";

  // QR-code URL
  const qrURL=`https://chart.googleapis.com/chart?cht=qr&chs=200x200&chl=BCD%0A002%0ABE%0A${IBAN}%0A%0A${totaal.toFixed(2)}%0AEUR%0A${mededeling}`;
  
  // Klikbare QR-code
  document.getElementById("qrCode").innerHTML=`
    <a href="https://www.abnamro.nl/nl/persoonlijk/betaalproducten/ideal/index.html" target="_blank" title="Klik hier om te betalen">
      <img src="${qrURL}" alt="QR Betaling">
      <div>Klik hier om te betalen</div>
    </a>
  `;

  // Leeg winkelmandje
  cart={};
  updateCart();
});

// üí≥ Betaalbuttons
document.getElementById("payPayconiq").onclick=()=>window.open("https://payconiq.com","_blank");
document.getElementById("payCash").onclick=()=>alert("üí∂ Betaling geregistreerd als contant.");
document.getElementById("payTransfer").onclick=()=>alert("üì≤ Scan de QR-code in je bank-app om te betalen.");

document.getElementById("closeOverlay").onclick=()=>document.getElementById("paymentOverlay").style.display="none";
</script>
</body>
</html>
