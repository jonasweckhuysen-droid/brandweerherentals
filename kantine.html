<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kantine Bestellen — Brandweer Herentals</title>
<link rel="stylesheet" href="/brandweerherentals/css/kantine.css">
</head>
<body>
<div class="container">
  <header>
    <h1>Kantine Bestellen</h1>
  </header>
  <main class="content">
    <label>Naam: <input type="text" id="name"></label>
    <label>Product:
      <select id="productSelect"></select>
    </label>
    <label>Aantal: <input type="number" id="quantity" value="1" min="1"></label>
    <label>Betaalwijze:
      <select id="payment">
        <option value="cash">Cash</option>
        <option value="payconiq">Payconiq</option>
      </select>
    </label>
    <button id="orderBtn">Bestel</button>
    <div id="msg" style="margin-top:10px;"></div>
  </main>
</div>

<script>
// 📡 Apps Script endpoint
const endpoint = "https://script.google.com/macros/s/AKfycbyJ-dqNiQ7Z187DIidfJahBFNB5RQcWFDQdZIxGKyzS3_Xf831SdsRSFyDxPFLQcTE/exec";

// 🛒 Producten laden
async function loadProducts() {
  try {
    const res = await fetch(endpoint);
    const products = await res.json();
    const sel = document.getElementById("productSelect");
    sel.innerHTML = "";
    products.forEach(p => {
      const opt = document.createElement("option");
      opt.value = p.name;
      opt.textContent = `${p.name} (${p.stock} stuks beschikbaar)`;
      sel.appendChild(opt);
    });
  } catch(err) {
    document.getElementById("msg").textContent = "❌ Kan producten niet laden: " + err;
  }
}

// 📝 Bestelling versturen
document.getElementById("orderBtn").addEventListener("click", async () => {
  const name = document.getElementById("name").value.trim();
  const product = document.getElementById("productSelect").value;
  const quantity = parseInt(document.getElementById("quantity").value,10);
  const paid = document.getElementById("payment").value;

  if (!name || !product || quantity < 1) return alert("Vul alles correct in!");

  try {
    const res = await fetch(endpoint, {
      method: "POST",
      body: JSON.stringify({name, product, quantity, paid})
    });
    const data = await res.json();
    if (data.status === "ok") {
      document.getElementById("msg").textContent = "✅ Bestelling geplaatst!";
      loadProducts(); // voorraad update in dropdown
    } else {
      document.getElementById("msg").textContent = "❌ Fout: " + data.message;
    }
  } catch(err) {
    document.getElementById("msg").textContent = "❌ Kan bestelling niet plaatsen: " + err;
  }
});

// Initialiseer
loadProducts();
</script>
</body>
</html>
