<script>
const producten = [
  { naam: "Pintje", prijs: 1.5, img: "/brandweerherentals/icons/drinks/beer.png" },
  { naam: "Cola", prijs: 1.8, img: "/brandweerherentals/icons/drinks/cola.png" },
  { naam: "Fanta", prijs: 1.8, img: "/brandweerherentals/icons/drinks/fanta.png" },
  { naam: "Water", prijs: 1.0, img: "/brandweerherentals/icons/drinks/water.png" },
  { naam: "Koffie", prijs: 1.2, img: "/brandweerherentals/icons/drinks/coffee.png" },
  { naam: "Chips", prijs: 1.5, img: "/brandweerherentals/icons/drinks/chips.png" }
];

const grid = document.getElementById("productGrid");
const cartList = document.getElementById("cartList");
const cartTotal = document.getElementById("cartTotal");
const confirmBtn = document.getElementById("confirmOrder");
let cart = {};

// üßÉ Producten tonen
producten.forEach(p=>{
  const card=document.createElement("div");
  card.className="product-card";
  card.innerHTML=`
    <img src="${p.img}" alt="${p.naam}">
    <h3>${p.naam}</h3>
    <p>‚Ç¨${p.prijs.toFixed(2)}</p>
    <div class="controls">
      <button class="minus">‚àí</button>
      <span>0</span>
      <button class="plus">+</button>
    </div>`;
  const countEl=card.querySelector("span");
  card.querySelector(".plus").onclick=()=>{ cart[p.naam]=(cart[p.naam]||0)+1; countEl.textContent=cart[p.naam]; updateCart(); };
  card.querySelector(".minus").onclick=()=>{ if(cart[p.naam]){ cart[p.naam]--; if(cart[p.naam]<=0) delete cart[p.naam]; countEl.textContent=cart[p.naam]||0; updateCart(); }};
  grid.appendChild(card);
});

// üßæ Winkelmandje bijwerken
function updateCart(){
  cartList.innerHTML="";
  let totaal=0;
  for(const [naam,aantal] of Object.entries(cart)){
    const p=producten.find(x=>x.naam===naam);
    const subt=p.prijs*aantal;
    totaal+=subt;
    const li=document.createElement("li");
    li.textContent=`${aantal} √ó ${naam} ‚Äî ‚Ç¨${subt.toFixed(2)}`;
    cartList.appendChild(li);
  }
  cartTotal.textContent=totaal>0?`Totaal te betalen: ‚Ç¨${totaal.toFixed(2)}`:"";
  confirmBtn.disabled=totaal===0;
}

// üíæ Bestelling bevestigen
confirmBtn.onclick=()=>{
  if(!Object.keys(cart).length) return;
  const timestamp=new Date().toLocaleString("nl-BE");
  const bestelling={tijd:timestamp, items:{...cart}};
  const bestellingen=JSON.parse(localStorage.getItem("kantine_bestellingen")||"[]");
  bestellingen.push(bestelling);
  localStorage.setItem("kantine_bestellingen",JSON.stringify(bestellingen));

  document.getElementById("paymentOverlay").style.display="flex";

  const totaal=Object.entries(cart).reduce((s,[n,a])=>{
    const p=producten.find(x=>x.naam===n); return s+p.prijs*a;
  },0);

  document.getElementById("overlayTotal").textContent=`üí∞ Totaal te betalen: ‚Ç¨${totaal.toFixed(2)}`;
  const IBAN="BE12345678901234";
  const mededeling="Kantine Brandweer Herentals";

  // üîß QR-code veilig genereren met encoding
  const qrData=`BCD\n002\n1\nSCT\n\n${IBAN}\n\n\n${totaal.toFixed(2)}\nEUR\n${mededeling}`;
  const qrURL=`https://chart.googleapis.com/chart?cht=qr&chs=200x200&chl=${encodeURIComponent(qrData)}`;

  document.getElementById("qrCode").innerHTML=`
    <img src="${qrURL}" alt="QR Betaling" style="margin-top:10px;border:1px solid #ccc;border-radius:8px;">
    <div style="margin-top:6px;">Scan met je bank-app om te betalen</div>
  `;

  cart={};
  updateCart();
};

// üí≥ Betaalopties
document.getElementById("payPayconiq").onclick=()=>{
  const totaal=document.getElementById("overlayTotal").textContent;
  document.getElementById("noticeMsg").innerHTML=`<div class="notice">üì≤ Open je Payconiq-app en betaal het bedrag.<br>${totaal}</div>`;
  localStorage.removeItem("kantine_bestellingen");
};

document.getElementById("payCash").onclick=()=>{
  const totaal=document.getElementById("overlayTotal").textContent;
  document.getElementById("noticeMsg").innerHTML=`<div class="notice">üí∂ Cash ontvangen.<br>${totaal}</div>`;
  localStorage.removeItem("kantine_bestellingen");
};

document.getElementById("payTransfer").onclick=()=>{
  const totaal=document.getElementById("overlayTotal").textContent;
  document.getElementById("noticeMsg").innerHTML=`<div class="notice">üè¶ Maak een overschrijving naar:<br><strong>IBAN:</strong> BE12345678901234<br><strong>Mededeling:</strong> Kantine Brandweer Herentals<br>${totaal}</div>`;
  localStorage.removeItem("kantine_bestellingen");
};

document.getElementById("closeOverlay").onclick=()=>{
  document.getElementById("paymentOverlay").style.display="none";
  document.getElementById("noticeMsg").innerHTML="";
};
</script>
