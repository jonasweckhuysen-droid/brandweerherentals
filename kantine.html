<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Kantine ‚Äî Brandweer Herentals</title>
<link rel="stylesheet" href="/brandweerherentals/kantine.css">
<meta name="theme-color" content="#c71f1f">
<style>
  body { font-family:system-ui, sans-serif; margin:0; background:#fafafa; color:#222; }
  .container { max-width:900px; margin:auto; padding:16px; }
  header {
    font-size:1.6em;
    font-weight:700;
    color:#fff;                     /* witte tekst zoals gevraagd */
    background: linear-gradient(90deg, #c71f1f, #8f1515); /* rode balk */
    padding:14px 12px;
    border-radius:8px;
    margin-bottom:10px;
  }
  .back-link { display:inline-block; margin:10px 0 20px 0; color:#c71f1f; font-weight:700; text-decoration:none; }
  .back-link:hover { text-decoration:underline; }
  .product-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(120px,1fr)); gap:12px; }
  .product-card { background:#fff; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,0.1); text-align:center; padding:10px; }
  .product-card img { width:60px; height:60px; object-fit:contain; }
  .product-card h3 { margin:8px 0 4px; font-size:1em; }
  .product-card p { margin:0 0 8px; color:#555; }
  .controls button { background:#c71f1f; color:#fff; border:none; border-radius:5px; padding:4px 8px; cursor:pointer; font-weight:700; }
  .controls span { display:inline-block; width:32px; text-align:center; font-weight:700; }
  .cart { background:#fff; margin-top:20px; padding:12px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
  .cart ul { list-style:none; padding:0; margin:0; }
  .cart li { display:flex; justify-content:space-between; padding:4px 0; border-bottom:1px solid #eee; }
  #cartTotal { text-align:right; font-weight:700; margin:10px 0; font-size:16px; }
  button#confirmOrder { width:100%; padding:10px; font-size:1em; font-weight:700; border:none; border-radius:6px; background:#c71f1f; color:#fff; cursor:pointer; }
  button#confirmOrder:disabled { opacity:0.5; cursor:not-allowed; }
  footer { margin-top:20px; text-align:center; color:#777; font-size:0.9em; }

  .overlay { position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:9999; }
  .overlay-content { background:#fff; padding:24px; border-radius:12px; max-width:420px; width:90%; text-align:center; box-shadow:0 4px 12px rgba(0,0,0,0.2); }
  .overlay-content h2 { margin-top:0; }
  .overlay-content button { margin:6px; padding:12px 20px; font-weight:700; border:none; border-radius:8px; cursor:pointer; }
  #qrCode img { margin-top:10px; width:200px; height:200px; object-fit:contain; display:block; margin-left:auto; margin-right:auto; }
  .notice { background:#e7f3ff; border:1px solid #90caf9; color:#0d47a1; padding:10px; border-radius:8px; margin-top:10px; font-size:0.95em; }
  .small-help { font-size:0.9em; color:#555; margin-top:6px; }
</style>
</head>
<body>
<div class="container">
  <header>
    Kantine ‚Äî Bestelling
  </header>

  <!-- terug-link onder header -->
  <a href="/brandweerherentals/" class="back-link">‚Üê Terug naar start</a>

  <main>
    <div class="product-grid" id="productGrid"></div>

    <div class="cart" id="cartSection">
      <h2>üßæ Jouw bestelling</h2>
      <ul id="cartList"></ul>
      <div id="cartTotal"></div>
      <button id="confirmOrder" disabled>Bevestig bestelling</button>
    </div>
  </main>

  <footer>Brandweer Herentals ‚Äî Kantinebeheer</footer>
</div>

<div id="paymentOverlay" class="overlay" style="display:none;">
  <div class="overlay-content" role="dialog" aria-modal="true" aria-labelledby="payTitle">
    <h2 id="payTitle">üí≥ Kies betaalmethode</h2>
    <p id="overlayTotal" style="font-weight:700;"></p>
    <button id="payPayconiq" style="background:#00b0ff;color:#fff;">Payconiq</button>
    <button id="payCash" style="background:#ffbb00;color:#111;">Cash</button>
    <button id="payTransfer" style="background:#00c853;color:#fff;">Bankoverschrijving</button>
    <div id="qrCode" aria-live="polite" class="small-help"></div>
    <div id="noticeMsg" class="small-help"></div>
    <button id="closeOverlay" style="margin-top:12px;background:#ccc;color:#111;">Sluiten</button>
  </div>
</div>

<script>
/* product data */
const producten = [
  { naam: "Pintje", prijs: 1.5, img: "/brandweerherentals/icons/drinks/beer.png" },
  { naam: "Cola", prijs: 1.8, img: "/brandweerherentals/icons/drinks/cola.png" },
  { naam: "Fanta", prijs: 1.8, img: "/brandweerherentals/icons/drinks/fanta.png" },
  { naam: "Water", prijs: 1.0, img: "/brandweerherentals/icons/drinks/water.png" },
  { naam: "Koffie", prijs: 1.2, img: "/brandweerherentals/icons/drinks/coffee.png" },
  { naam: "Chips", prijs: 1.5, img: "/brandweerherentals/icons/drinks/chips.png" }
];

const grid = document.getElementById("productGrid");
const cartList = document.getElementById("cartList");
const cartTotal = document.getElementById("cartTotal");
const confirmBtn = document.getElementById("confirmOrder");
const qrCodeContainer = document.getElementById("qrCode");
const noticeMsg = document.getElementById("noticeMsg");
let cart = {};

/* render products */
producten.forEach(p=>{
  const card = document.createElement("div");
  card.className = "product-card";
  card.innerHTML = `
    <img src="${p.img}" alt="${p.naam}">
    <h3>${p.naam}</h3>
    <p>‚Ç¨${p.prijs.toFixed(2)}</p>
    <div class="controls">
      <button class="minus" aria-label="verlaag">‚àí</button>
      <span aria-live="polite">0</span>
      <button class="plus" aria-label="verhoog">+</button>
    </div>
  `;
  const countEl = card.querySelector("span");
  const minusBtn = card.querySelector(".minus");
  const plusBtn = card.querySelector(".plus");

  plusBtn.onclick = () => {
    cart[p.naam] = (cart[p.naam] || 0) + 1;
    countEl.textContent = cart[p.naam];
    updateCart();
  };
  minusBtn.onclick = () => {
    if (!cart[p.naam]) return;
    cart[p.naam]--;
    if (cart[p.naam] <= 0) { delete cart[p.naam]; countEl.textContent = 0; }
    else countEl.textContent = cart[p.naam];
    updateCart();
  };

  grid.appendChild(card);
});

/* update cart UI */
function updateCart(){
  cartList.innerHTML = "";
  let totaal = 0;
  for (const [naam,aantal] of Object.entries(cart)){
    const product = producten.find(p=>p.naam===naam);
    const subtotaal = product.prijs * aantal;
    totaal += subtotaal;

    const li = document.createElement("li");
    li.textContent = `${aantal} √ó ${naam}`;
    const price = document.createElement("span");
    price.textContent = `‚Ç¨${subtotaal.toFixed(2)}`;
    li.appendChild(price);
    cartList.appendChild(li);
  }

  if (totaal === 0) {
    cartList.innerHTML = "<li>Geen producten geselecteerd.</li>";
    cartTotal.textContent = "";
    confirmBtn.disabled = true;
  } else {
    const totalLi = document.createElement("li");
    totalLi.innerHTML = `<strong>Totaal</strong><span><strong>‚Ç¨${totaal.toFixed(2)}</strong></span>`;
    cartList.appendChild(totalLi);
    cartTotal.textContent = `Totaal te betalen: ‚Ç¨${totaal.toFixed(2)}`;
    confirmBtn.disabled = false;
  }
}

/* helper: reset counters on screen (after clearing cart) */
function resetProductCounters(){
  const spans = document.querySelectorAll(".product-card .controls span");
  spans.forEach(s => s.textContent = "0");
}

/* build QR payload (EPC QR-ish simple) and show with fallback */
function showPaymentOverlay(totaal){
  const IBAN = "BE12345678901234";
  const mededeling = "Kantine Brandweer Herentals";
  const bedrag = Number(totaal).toFixed(2);

  // Build payload lines (simple EPC-like). Use encodeURIComponent for safety.
  const payload = [
    "BCD",        // service tag
    "002",        // version
    "1",          // character set
    "SCT",        // transfer type
    "",           // beneficiary name (left empty to keep payload short)
    IBAN,         // IBAN
    "",           // beneficiary BIC (optional)
    bedrag,       // amount
    "EUR",        // currency
    mededeling    // remittance
  ].join("\n");

  // Primary QR (Google Charts) + fallback (qrserver)
  const primary = "https://chart.googleapis.com/chart?cht=qr&chs=200x200&chl=" + encodeURIComponent(payload);
  const fallback = "https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=" + encodeURIComponent(payload);

  // Build image element with onerror fallback
  qrCodeContainer.innerHTML = ""; // clear
  const img = document.createElement("img");
  img.alt = "QR Betaling";
  img.src = primary;
  img.onload = () => {
    // ok
  };
  img.onerror = () => {
    // switch to fallback provider
    img.onerror = null;
    img.src = fallback;
  };
  qrCodeContainer.appendChild(img);

  // small help text
  const help = document.createElement("div");
  help.className = "small-help";
  help.textContent = "Scan met je bank-app (of open overschrijving met onderstaande gegevens).";
  qrCodeContainer.appendChild(help);

  // Also provide textual IBAN + mededeling visible for copy/paste
  noticeMsg.innerHTML = `
    <div class="notice">
      <div><strong>IBAN:</strong> ${IBAN}</div>
      <div><strong>Mededeling:</strong> ${mededeling}</div>
      <div style="margin-top:6px;"><strong>Bedrag:</strong> ‚Ç¨${bedrag}</div>
    </div>
  `;
}

/* Confirm order flow */
confirmBtn.addEventListener("click", () => {
  if (Object.keys(cart).length === 0) return;

  // Save order locally (still). In production this should post to your API.
  const timestamp = new Date().toLocaleString("nl-BE");
  const bestelling = { tijd: timestamp, items: { ...cart } };
  const bestellingen = JSON.parse(localStorage.getItem("kantine_bestellingen") || "[]");
  bestellingen.push(bestelling);
  localStorage.setItem("kantine_bestellingen", JSON.stringify(bestellingen));

  // compute total
  const totaal = Object.entries(cart).reduce((sum, [naam,aantal]) => {
    const p = producten.find(x=>x.naam===naam);
    return sum + p.prijs * aantal;
  }, 0);

  // show overlay and QR
  document.getElementById("paymentOverlay").style.display = "flex";
  document.getElementById("overlayTotal").textContent = `üí∞ Totaal te betalen: ‚Ç¨${totaal.toFixed(2)}`;
  showPaymentOverlay(totaal);

  // clear cart + reset visible counters
  cart = {};
  updateCart();
  resetProductCounters();
});

/* payment option handlers (they all clear the stored local "bestellingen" now) */
document.getElementById("payPayconiq").onclick = () => {
  const tot = document.getElementById("overlayTotal").textContent;
  noticeMsg.innerHTML = `<div class="notice">üì≤ Open je Payconiq-app en betaal het bedrag.<br>${tot}</div>`;
  // clear pending local storage orders (we assume payment handled)
  localStorage.removeItem("kantine_bestellingen");
};

document.getElementById("payCash").onclick = () => {
  const tot = document.getElementById("overlayTotal").textContent;
  noticeMsg.innerHTML = `<div class="notice">üí∂ Bedrag ontvangen in cash.<br>${tot}</div>`;
  localStorage.removeItem("kantine_bestellingen");
};

document.getElementById("payTransfer").onclick = () => {
  const tot = document.getElementById("overlayTotal").textContent;
  // also show same textual info (already in noticeMsg from showPaymentOverlay)
  // ensure local storage cleared
  localStorage.removeItem("kantine_bestellingen");
};

document.getElementById("closeOverlay").onclick = () => {
  document.getElementById("paymentOverlay").style.display = "none";
  noticeMsg.innerHTML = "";
  qrCodeContainer.innerHTML = "";
};
</script>
</body>
</html>
