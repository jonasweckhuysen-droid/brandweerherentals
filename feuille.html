<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Personeelsfeuille – Brandweer Herentals</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="style.css">

  <style>
    body {
      margin: 0;
      background: #111;
      overflow-y: scroll;
      font-family: Arial;
    }

    .page {
      position: relative;
      width: 794px;
      margin: 30px auto;
      background: white;
      box-shadow: 0 0 15px black;
    }

    .page canvas {
      width: 794px;
    }

    .field {
      position: absolute;
      min-width: 60px;
      min-height: 20px;
      border: 1px dashed rgba(0,0,0,0.4);
      background: rgba(255,255,255,0.6);
      padding: 2px;
      font-size: 12px;
      cursor: move;
    }

    .field input, .field select, .field textarea {
      width: 100%;
      border: none;
      background: transparent;
      font-size: 12px;
      resize: none;
      outline: none;
    }

    #toolbar {
      position: fixed;
      top: 10px;
      left: 10px;
      background: black;
      padding: 10px;
      border-radius: 10px;
      z-index: 1000;
    }

    #toolbar button {
      padding: 8px 15px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="toolbar">
  <button onclick="saveLayout()">Posities opslaan</button>
  <button onclick="resetLayout()">Reset</button>
</div>

<!-- Pagina 1 -->
<div class="page" id="page1">
  <canvas id="pdf1"></canvas>
</div>

<!-- Pagina 2 -->
<div class="page" id="page2">
  <canvas id="pdf2"></canvas>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

<script>
const url = "personeelsfeuille.pdf";

const fields = [
  { id:"datum", page:1, x:50, y:100, w:120, h:20, type:"input"},
  { id:"omschrijving", page:1, x:50, y:140, w:300, h:40, type:"textarea"},
  { id:"uur", page:1, x:50, y:190, w:140, h:20, type:"input"},
  { id:"locatie", page:1, x:50, y:230, w:250, h:20, type:"input"},
  { id:"type", page:1, x:50, y:270, w:200, h:20, type:"select", options:["Interventie","Ambulance","Onderhoud","Wacht / permanentie"]},
  { id:"xdko", page:1, x:260, y:270, w:60, h:20, type:"select", options:["","X","D","K","O"]},
  { id:"voertuig", page:1, x:50, y:310, w:120, h:20, type:"input"},
  { id:"handtekening", page:1, x:50, y:350, w:200, h:40, type:"input"},
  { id:"afwijkend", page:1, x:50, y:400, w:200, h:20, type:"input"},
  { id:"opmerking", page:2, x:50, y:100, w:500, h:60, type:"textarea"},
];

async function loadPDF() {
  const pdf = await pdfjsLib.getDocument(url).promise;

  renderPage(pdf, 1, "pdf1");
  renderPage(pdf, 2, "pdf2");
  placeFields();
}

async function renderPage(pdf, pageNumber, canvasId){
  const page = await pdf.getPage(pageNumber);
  const scale = 1.3;
  const viewport = page.getViewport({ scale: scale });

  const canvas = document.getElementById(canvasId);
  const ctx = canvas.getContext("2d");

  canvas.height = viewport.height;
  canvas.width = viewport.width;

  await page.render({ canvasContext: ctx, viewport: viewport }).promise;
}

function placeFields(){
  fields.forEach(f => {
    const page = document.getElementById("page"+f.page);
    const div = document.createElement("div");
    div.className = "field";
    div.id = f.id;

    let saved = localStorage.getItem("pos_"+f.id);
    if(saved){
      const p = JSON.parse(saved);
      f.x = p.x; f.y = p.y; f.w = p.w; f.h = p.h;
    }

    div.style.left = f.x + "px";
    div.style.top = f.y + "px";
    div.style.width = f.w + "px";
    div.style.height = f.h + "px";

    if(f.type === "input"){
      div.innerHTML = `<input placeholder="${f.id}">`;
    }

    if(f.type === "textarea"){
      div.innerHTML = `<textarea rows="3" placeholder="${f.id}"></textarea>`;
    }

    if(f.type === "select"){
      let html = "<select>";
      f.options.forEach(o => html += `<option>${o}</option>`);
      html += "</select>";
      div.innerHTML = html;
    }

    dragElement(div);
    page.appendChild(div);
  });
}

function dragElement(el){
  let pos1=0,pos2=0,pos3=0,pos4=0;

  el.onmousedown = dragMouseDown;

  function dragMouseDown(e){
    e.preventDefault();
    pos3 = e.clientX;
    pos4 = e.clientY;

    document.onmouseup = closeDragElement;
    document.onmousemove = elementDrag;
  }

  function elementDrag(e){
    e.preventDefault();
    pos1 = pos3 - e.clientX;
    pos2 = pos4 - e.clientY;
    pos3 = e.clientX;
    pos4 = e.clientY;

    el.style.top = (el.offsetTop - pos2) + "px";
    el.style.left = (el.offsetLeft - pos1) + "px";
  }

  function closeDragElement(){
    document.onmouseup = null;
    document.onmousemove = null;
  }
}

function saveLayout(){
  fields.forEach(f => {
    const el = document.getElementById(f.id);
    const data = {
      x: el.offsetLeft,
      y: el.offsetTop,
      w: el.offsetWidth,
      h: el.offsetHeight
    };
    localStorage.setItem("pos_"+f.id, JSON.stringify(data));
  });
  alert("Posities opgeslagen ✅");
}

function resetLayout(){
  fields.forEach(f => localStorage.removeItem("pos_"+f.id));
  location.reload();
}

loadPDF();
</script>

</body>
</html>
