<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Brandweer Herentals â€” Portal</title>
<link rel="manifest" href="/brandweerherentals/manifest.json">
<meta name="theme-color" content="#c71f1f">
<style>
:root {
  --red: #c71f1f;
  --dark: #111;
  --light: #fff;
  --muted: #f6f6f6;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
html, body { margin: 0; padding: 0; min-height: 100%; }
body { background: linear-gradient(180deg, #fff 0%, #f8f8f8 100%); display: flex; justify-content: center; align-items: flex-start; padding: 20px; -webkit-font-smoothing: antialiased; overflow-y: auto; }
.container { width: 100%; max-width: 780px; background: var(--light); border-radius: 18px; border: 4px solid var(--red); box-shadow: 0 8px 30px rgba(0,0,0,0.08); display: flex; flex-direction: column; height: auto; overflow: hidden; }
header { display: flex; align-items: center; justify-content: space-between; padding: 18px; background: linear-gradient(90deg, var(--red), #8f1515); color: var(--light); }
.header-left { display: flex; align-items: center; gap: 12px; }
header .logo { width: 52px; height: 52px; border-radius: 10px; background: rgba(255,255,255,0.08); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 20px; }
header h1 { margin: 0; font-size: 18px; }
header p { margin: 0; font-size: 12px; opacity: 0.9; }
#header-right { text-align: right; }
#datetime { font-size: 14px; opacity: 0.9; }
#ploegOfWeek { font-weight:600; font-size:14px; color:#fff; margin-top:2px; }
main.content { flex: 1 1 auto; padding: 18px; }
.grid { display: grid; gap: 12px; grid-template-columns: 1fr; }
@media (min-width: 620px) { .grid { grid-template-columns: 1fr 1fr; } }
.btn { display: flex; align-items: center; gap: 14px; padding: 16px; border-radius: 12px; text-decoration: none; font-weight: 700; font-size: 16px; box-shadow: 0 4px 8px rgba(0,0,0,0.04); transition: 0.06s; color: var(--dark); background: var(--muted); }
.btn:active { transform: translateY(1px); }
.btn .icon { width: 52px; height: 52px; min-width: 52px; border-radius: 10px; background: linear-gradient(180deg, #fff, #f0f0f0); display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.06); overflow: hidden; }
.btn img { width: 100%; height: 100%; object-fit: cover; border-radius: 10px; }
.btn small { display: block; font-size: 12px; opacity: 0.8; margin-top: 4px; }
footer { padding: 12px 18px; font-size: 13px; color: #444; background: #fff; border-top: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }

/* Install prompt */
#installPrompt {
  display:none;
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#c71f1f;
  color:white;
  padding:12px 16px;
  text-align:center;
  font-weight:700;
  z-index:9999;
  font-size:14px;
  border-top-left-radius:12px;
  border-top-right-radius:12px;
  box-shadow:0 -2px 8px rgba(0,0,0,0.3);
  display:flex;
  justify-content:center;
  align-items:center;
  gap:12px;
}
#installPrompt button {
  padding:6px 12px;
  border:none;
  border-radius:8px;
  background:white;
  color:#c71f1f;
  font-weight:700;
  cursor:pointer;
}
#installPrompt span.close {
  cursor:pointer;
  font-weight:700;
}
</style>
</head>
<body>
<div class="container" role="application" aria-label="Fire Crew Herentals portal">
<header>
  <div class="header-left">
    <div class="logo">BWH</div>
    <div>
      <h1>Brandweer Herentals</h1>
      <p>Interne app</p>
    </div>
  </div>
 <div id="header-right">
  <div id="datetime"></div>
  <div id="ploegOfWeek"></div>
</div>
</header>
<main class="content">
  <div class="grid" id="buttonGrid"></div>
</main>
<footer>
  <div>Versie 1.1</div>
  <div>ðŸ“± Voeg toe aan startscherm</div>
</footer>
</div>

<!-- Install prompt -->
<div id="installPrompt">
  <span id="installText">ðŸ“² Voeg de app toe aan je startscherm</span>
  <button id="installNow">Toevoegen</button>
  <span class="close" id="installClose">âœ–</span>
</div>

<script>
// ðŸ”— Links instellen (inclusief kantine)
const links = {
  abiweb: { title: "Abiweb", icon: "/brandweerherentals/icons/buttons/abiweb.png", desc: "Oefeningen en prestaties", url: "https://identity.brandweerzonekempen.be/Identity/Account/Login?ReturnUrl=%2Fconnect%2Fauthorize%3Fclient_id%3Dabiweb.client.new" },
  agenda: { title: "Agenda", icon: "ðŸ“…", desc: "Belangrijke data en evenementen", url: "/brandweerherentals/agenda.html" },
  defect: { title: "Defectmelding", icon: "ðŸ”§", desc: "Meld snel defecten aan materiaal of voertuigen", url: "https://forms.cloud.microsoft/Pages/ResponsePage.aspx?id=ex_6l868RE6S2t-IkEL0dqocXptaGhNPlV-vS_rmuEtUNTZUNVFFSUQwRldXTkpKREpGVlYyUzIwWC4u" },
  kantine: { title: "Kantine", icon: "ðŸ»", desc: "Bestel en betaal drank & snacks", url: "/brandweerherentals/kantine.html" },
  logistiek: { title: "Logistiek", icon: "/brandweerherentals/icons/buttons/winkelkar.png", desc: "Meld een logistiek transport aan", url: "https://form.jotform.com/230682691731055" },
  order: { title: "Bestelling", icon: "ðŸ“¦", desc: "Bestel materiaal of verbruiksgoederen", url: "https://forms.cloud.microsoft/e/GjHr1Kym0w" },
  vehicle: { title: "Voertuigreservatie", icon: "ðŸš’", desc: "Reserveer een voertuig of controleer beschikbaarheid", url: "https://forms.cloud.microsoft/Pages/ResponsePage.aspx?id=ex_6l868RE6S2t-IkEL0dqocXptaGhNPlV-vS_rmuEtUN0JBTzkySTI0STFZUlk4Q01GOVRTR1UzMy4u" },
  verdi: { title: "Verdi", icon: "/brandweerherentals/icons/buttons/verdi.png", desc: "Oproepen en status aanpassen", url: "https://kempen.verdi.cloud/" },
  wegenwerken: { title: "Wegenwerken", icon: "ðŸš§", desc: "Actuele info over werken in Herentals", url: "/brandweerherentals/wegenwerken.html" },
  wespen: { title: "Wespen", icon: "ðŸ", desc: "Ploeg van dienst wespenverdelging", url: "/brandweerherentals/wespen.html" }
};

// ðŸ”¤ Alfabetisch sorteren & tonen
const sorted = Object.values(links).sort((a,b)=>a.title.localeCompare(b.title,'nl'));
const grid = document.getElementById("buttonGrid");
sorted.forEach(item => {
  const a = document.createElement("a");
  a.className = "btn";
  a.href = item.url;
  a.innerHTML = `
    <div class="icon">${item.icon.endsWith(".png") ? `<img src="${item.icon}" alt="${item.title}">` : item.icon}</div>
    <div>
      <div>${item.title}</div>
      <small>${item.desc}</small>
    </div>`;
  grid.appendChild(a);
});

// ðŸ•’ Datum & ploeg
document.addEventListener("DOMContentLoaded", () => {
  const cyclus = ["A1","B1","C1","A2","B2","C2"];
  const referentie = new Date("2025-01-03T12:00:00");

  function currentPloegVanWeek(){
    const now = new Date();
    const msPerWeek = 7*24*60*60*1000;
    const diffMs = now - referentie;
    const weeksElapsed = Math.floor(diffMs / msPerWeek);
    const index = ((weeksElapsed % cyclus.length)+cyclus.length)%cyclus.length;
    return cyclus[index];
  }

  const datetimeEl = document.getElementById("datetime");
  const ploegEl = document.getElementById("ploegOfWeek");

  function updateHeader(){
    const now = new Date();
    const options = { weekday:'short', day:'2-digit', month:'short', hour:'2-digit', minute:'2-digit' };
    datetimeEl.textContent = now.toLocaleString('nl-BE',options);
    ploegEl.textContent = "Ploeg van week: " + currentPloegVanWeek();
  }
  setInterval(updateHeader,1000);
  updateHeader();
});

// ðŸ“² Universele installatieprompt
let deferredPrompt;
const installPrompt = document.getElementById("installPrompt");
const installBtnNow = document.getElementById("installNow");
const installClose = document.getElementById("installClose");

function showInstallPrompt(text){
  document.getElementById("installText").textContent = text;
  installPrompt.style.display = "flex";
}
function hideInstallPrompt(){
  installPrompt.style.display = "none";
}

// Android / Chrome / Edge
window.addEventListener('beforeinstallprompt', (e)=>{
  e.preventDefault();
  deferredPrompt = e;
  showInstallPrompt("ðŸ“² Installeer deze app op je startscherm");
});

installBtnNow.addEventListener('click', async ()=>{
  const ua = navigator.userAgent.toLowerCase();
  const isIOS = /iphone|ipad|ipod/.test(ua);

  if(isIOS){
    alert("ðŸ“² Op iPhone of iPad: tik op het deel-icoon (vierkant met pijltje omhoog) en kies â€˜Zet op beginschermâ€™ om de app te installeren.");
    hideInstallPrompt();
    return;
  }

  if(deferredPrompt){
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    console.log("Installatie keuze:", outcome);
    deferredPrompt = null;
    hideInstallPrompt();
  }
});

installClose.addEventListener('click', hideInstallPrompt);

// iOS fallback
window.addEventListener("load", ()=>{
  const ua = navigator.userAgent.toLowerCase();
  const isIOS = /iphone|ipad|ipod/.test(ua);
  const isStandalone = window.navigator.standalone === true;

  if(isIOS && !isStandalone && !localStorage.getItem("iosInstallHintShown")){
    showInstallPrompt("ðŸ“² Voeg de app toe aan je startscherm via 'Deel' â†’ 'Zet op beginscherm'");
    localStorage.setItem("iosInstallHintShown","true");
  }
});
</script>
</body>
</html>
