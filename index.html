<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Brandweer Herentals â€” Portal</title>

<!-- PWA -->
<link rel="manifest" href="/brandweerherentals/manifest.json">
<meta name="theme-color" content="#c71f1f">

<!-- Centrale layout -->
<link rel="stylesheet" href="style.css">

</head>
<body>

<div class="container" role="application" aria-label="Brandweer Herentals portal">

  <!-- -----------------------------------
       HEADER
  ------------------------------------ -->
  <header id="appHeader">
    <div class="header-left">
      <img src="/brandweerherentals/icons/logo.png"
           alt="Brandweer Herentals"
           class="header-logo">
    </div>
    <div class="header-right">
      <div id="greeting" class="header-greeting"></div>
      <div id="datetime" class="header-datetime"></div>
      <div id="ploegOfWeek" class="header-ploeg"></div>
    </div>
  </header>

  <!-- -----------------------------------
       CONTENT
  ------------------------------------ -->
  <main class="content">
    <div id="welcomeOverlay" class="overlay">
  <div class="overlay-content" role="dialog" aria-modal="true">
    <h2>Welkom bij Brandweer Herentals Portal</h2>
    
    <label for="userNameInput">Wat is je naam?</label>
    <input type="text" id="userNameInput" placeholder="Vul je naam in">

    <label for="vzwInput">Ben je lid van de VZW? (optioneel)</label>
    <input type="password" id="vzwInput" placeholder="Vul wachtwoord in">

    <h3>Kies je specialiteit:</h3>
    <div class="specialiteit-options">
      <label class="radio-btn">
        <input type="radio" name="specialiteit" value="brandweer" checked>
        <span class="circle"></span> Brandweer
      </label>
      <label class="radio-btn">
        <input type="radio" name="specialiteit" value="ambulancier">
        <span class="circle"></span> Ambulancier
      </label>
      <label class="radio-btn">
        <input type="radio" name="specialiteit" value="chauffeur">
        <span class="circle"></span> Chauffeur
      </label>
      <label class="radio-btn">
        <input type="radio" name="specialiteit" value="duiker">
        <span class="circle"></span> Duiker
      </label>
      <label class="radio-btn">
        <input type="radio" name="specialiteit" value="firecrew">
        <span class="circle"></span> VZW Firecrew
      </label>
    </div>

    <button id="confirmUserBtn">Bevestigen</button>
  </div>
    </div>

    <div class="grid" id="buttonGrid" aria-live="polite"></div>

    <!-- Install PWA prompt -->
    <div id="installPrompt" class="overlay" style="display:none;">
      <div class="overlay-content" role="dialog" aria-modal="true">
        <span id="installText">ðŸ“² Voeg de app toe aan je startscherm</span>
        <button id="installNow">Toevoegen</button>
        <span class="close" id="installClose">âœ–</span>
      </div>
    </div>

  </main>

  <!-- -----------------------------------
       FOOTER
  ------------------------------------ -->
  <footer>
    <div>Versie 1.1</div>
    <div></div>
  </footer>

</div> <!-- container -->

<!-- ================================
     SCRIPTS
=============================== -->
<script>
// =====================================
// ðŸ” Vraag naam + VZW + Specialiteit
// =====================================
let userName = localStorage.getItem("userName");
let isVZW = localStorage.getItem("isVZW");
let specialization = localStorage.getItem("specialization");

async function askUser() {

  document.getElementById("confirmUserBtn").addEventListener("click", () => {
  const userNameInput = document.getElementById("userNameInput").value.trim();
  const vzwInput = document.getElementById("vzwInput").value.trim();
  const specialiteit = document.querySelector('input[name="specialiteit"]:checked').value;

  if (!userNameInput) return alert("Vul je naam in!");

  localStorage.setItem("userName", userNameInput);
  const greet = document.getElementById("greeting");
  if (greet) greet.textContent = `Welkom, ${userNameInput}!`;

  if (specialiteit === "firecrew" && vzwInput !== "Oudstrijder") {
    alert("Fout wachtwoord voor VZW Firecrew!");
    return;
  }

  if (specialiteit === "firecrew") localStorage.setItem("isVZW","true");
  else localStorage.setItem("isVZW","false");

  localStorage.setItem("specialiteit", specialiteit);
  document.getElementById("welcomeOverlay").style.display = "none";

  // Knoppen renderen afhankelijk van specialiteit
  if (specialiteit === "ambulancier") links.ambulance = { title:"Ambulance", icon:"ðŸš‘", desc:"Toegang Ambulance", url:"/brandweerherentals/ambulance.html" };
  if (specialiteit === "chauffeur") links.chauffeur = { title:"Chauffeur", icon:"ðŸš›", desc:"Toegang Chauffeur", url:"/brandweerherentals/chauffeur.html" };
  if (specialiteit === "duiker") links.duiker = { title:"Duiker", icon:"ðŸ¤¿", desc:"Toegang Duiker", url:"/brandweerherentals/duiker.html" };
  if (specialiteit === "firecrew") links.firecrew = { title:"Firecrew", icon:"ðŸ”¥", desc:"Exclusief", url:"/brandweerherentals/firecrew.html" };

  renderGrid();
});

// Functie grid renderen (verplaats bestaande code hiernaartoe)
function renderGrid() {
  const grid = document.getElementById("buttonGrid");
  grid.innerHTML = "";
  Object.values(links).sort((a,b)=>a.title.localeCompare(b.title,"nl")).forEach(item => {
    const a = document.createElement("a");
    a.className = "btn";
    a.href = item.url;
    a.innerHTML = `
      <div class="icon">${item.icon.endsWith(".png")? `<img src="${item.icon}" alt="${item.title}">`:item.icon}</div>
      <div>
        <div>${item.title}</div>
        <small>${item.desc}</small>
      </div>
    `;
    grid.appendChild(a);
  });
}

// Als er al lokaal iets opgeslagen is (herladen pagina), toon grid direct
if(localStorage.getItem("userName")) {
  const greet = document.getElementById("greeting");
  greet.textContent = `Welkom, ${localStorage.getItem("userName")}!`;

  const specialiteit = localStorage.getItem("specialiteit");
  if (specialiteit === "ambulancier") links.ambulance = { title:"Ambulance", icon:"ðŸš‘", desc:"Toegang Ambulance", url:"/brandweerherentals/ambulance.html" };
  if (specialiteit === "chauffeur") links.chauffeur = { title:"Chauffeur", icon:"ðŸš›", desc:"Toegang Chauffeur", url:"/brandweerherentals/chauffeur.html" };
  if (specialiteit === "duiker") links.duiker = { title:"Duiker", icon:"ðŸ¤¿", desc:"Toegang Duiker", url:"/brandweerherentals/duiker.html" };
  if (specialiteit === "firecrew") links.firecrew = { title:"Firecrew", icon:"ðŸ”¥", desc:"Exclusief", url:"/brandweerherentals/firecrew.html" };

  document.getElementById("welcomeOverlay").style.display = "none";
  renderGrid();
}
// =====================================
// ðŸ”— Knoppen/grid
// =====================================
const links = {
  abiweb: { title:"Abiweb", icon:"/brandweerherentals/icons/buttons/abiweb.png", desc:"Oefeningen en prestaties", url:"https://identity.brandweerzonekempen.be/Identity/Account/Login?ReturnUrl=%2Fconnect%2Fauthorize%3Fclient_id%3Dabiweb.client.new" },
  agenda: { title:"Agenda", icon:"ðŸ“…", desc:"Belangrijke data en evenementen", url:"/brandweerherentals/agenda.html" },
  defect: { title:"Defectmelding", icon:"ðŸ”§", desc:"Meld defecten", url:"https://forms.cloud.microsoft/Pages/ResponsePage.aspx?id=ex_6l868RE6S2t-IkEL0dqocXptaGhNPlV-vS_rmuEtUNTZUNVFFSUQwRldXTkpKREpGVlYyUzIwWC4u" },
  kantine: { title:"Kantine", icon:"ðŸ»", desc:"Bestellen & betalen", url:"/brandweerherentals/kantine.html" },
  logistiek: { title:"Logistiek", icon:"/brandweerherentals/icons/buttons/winkelkar.png", desc:"Transport aanvragen", url:"https://form.jotform.com/230682691731055" },
  order: { title:"Bestelling", icon:"ðŸ“¦", desc:"Materiaal bestellen", url:"https://forms.cloud.microsoft/e/GjHr1Kym0w" },
  vehicle: { title:"Voertuigreservatie", icon:"ðŸš’", desc:"Controle & reservatie", url:"https://forms.cloud.microsoft/Pages/ResponsePage.aspx?id=ex_6l868RE6S2t-IkEL0dqocXptaGhNPlV-vS_rmuEtUN0JBTzkySTI0STFZUlk4Q01GOVRTR1UzMy4u" },
  verdi: { title:"Verdi", icon:"/brandweerherentals/icons/buttons/verdi.png", desc:"Oproepen", url:"https://kempen.verdi.cloud/" },
  wegenwerken: { title:"Wegenwerken", icon:"ðŸš§", desc:"Actuele info", url:"/brandweerherentals/wegenwerken.html" },
  wespen: { title:"Wespen", icon:"ðŸ", desc:"Ploeg van dienst", url:"/brandweerherentals/wespen.html" }
};

// Extra knop voor specialiteiten
if (specialization) {
  switch(specialization) {
    case "duiker":
      links.duiker = { title:"Duiker", icon:"ðŸ¤¿", desc:"Toegang Duikpagina", url:"/brandweerherentals/duiker.html" };
      break;
    case "chauffeur":
      links.chauffeur = { title:"Chauffeur", icon:"ðŸš—", desc:"Toegang Chauffeurpagina", url:"/brandweerherentals/chauffeur.html" };
      break;
    case "ambulancier":
      links.ambulancier = { title:"Ambulancier", icon:"ðŸš‘", desc:"Toegang Ambulancepagina", url:"/brandweerherentals/ambulance.html" };
      break;
    default: // brandweer of onbekend
      break;
  }
}

// Extra knop voor VZW
if (isVZW === "true") {
  links.firecrew = { title:"Firecrew", icon:"ðŸ”¥", desc:"Exclusief", url:"/brandweerherentals/firecrew.html" };
}

// Grid render
const grid = document.getElementById("buttonGrid");
Object.values(links).sort((a,b)=>a.title.localeCompare(b.title,"nl")).forEach(item => {
  const a = document.createElement("a");
  a.className = "btn";
  a.href = item.url;
  a.innerHTML = `
    <div class="icon">${item.icon.endsWith(".png")? `<img src="${item.icon}" alt="${item.title}">`:item.icon}</div>
    <div>
      <div>${item.title}</div>
      <small>${item.desc}</small>
    </div>
  `;
  grid.appendChild(a);
});

// =====================================
// ðŸ“² PWA INSTALL PROMPT
// =====================================
let deferredPrompt;
const installPrompt = document.getElementById("installPrompt");
const installBtn = document.getElementById("installNow");
const installClose = document.getElementById("installClose");

window.addEventListener("beforeinstallprompt", e => {
  e.preventDefault();
  deferredPrompt = e;
  installPrompt.style.display = "flex";
});

installBtn.addEventListener("click", async () => {
  const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
  if (isIOS) { alert("Op iPhone/iPad: gebruik â€˜Zet op beginschermâ€™."); installPrompt.style.display="none"; return; }
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const result = await deferredPrompt.userChoice;
    if(result.outcome==="accepted") localStorage.setItem("appInstalled","true");
    installPrompt.style.display="none";
  }
});

installClose.addEventListener("click", ()=>installPrompt.style.display="none");
</script>

<!-- Header script -->
<script src="/brandweerherentals/header.js"></script>

</body>
</html>

