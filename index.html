<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Brandweer Herentals â€” Portal</title>

<!-- PWA -->
<link rel="manifest" href="/brandweerherentals/manifest.json">
<meta name="theme-color" content="#c71f1f">

<!-- Centrale layout -->
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="container" role="application" aria-label="Brandweer Herentals portal">

<!-- -----------------------------------
     HEADER
------------------------------------ -->
<header>
  <div class="header-left">
    <div class="logo">BWH</div>
    <div>
      <h1>Brandweer Herentals</h1>
      <p>Interne app</p>
      <div id="greeting"></div>
    </div>
  </div>

  <div id="header-right">
    <div id="datetime"></div>
    <div id="ploegOfWeek"></div>
  </div>
</header>

<!-- -----------------------------------
     CONTENT
------------------------------------ -->
<main class="content">

  <div class="grid" id="buttonGrid"></div>

  <!-- Install PWA prompt -->
  <div id="installPrompt">
    <span id="installText">ðŸ“² Voeg de app toe aan je startscherm</span>
    <button id="installNow">Toevoegen</button>
    <span class="close" id="installClose">âœ–</span>
  </div>

</main>

<!-- -----------------------------------
     FOOTER
------------------------------------ -->
<footer>
  <div>Versie 1.1</div>
  <div></div>
</footer>

</div> <!-- container -->


<!-- -----------------------------------
     SCRIPT
------------------------------------ -->
<script>
// =====================================================================================
// ðŸ” PERSOONLIJKE BEVEILIGING + BEGROETING
// =====================================================================================
let userName = localStorage.getItem("userName");
let isVZW = localStorage.getItem("isVZW");

async function askUser() {
  if (!userName) {
    userName = prompt("Wat is je naam?");
    if (userName) localStorage.setItem("userName", userName);
  }

  if (!isVZW) {
    let vzwInput = prompt("Ben je lid van de VZW? Vul wachtwoord in:");
    if (vzwInput === "Oudstrijder") {
      isVZW = "true";
      localStorage.setItem("isVZW", "true");
    } else {
      isVZW = "false";
      localStorage.setItem("isVZW", "false");
    }
  }

  document.getElementById("greeting").textContent =
    userName ? `Welkom, ${userName}!` : "";
}

askUser();


// =====================================================================================
// ðŸ”— KNOPPEN DEFINITIE (origineel + Firecrew extra)
// =====================================================================================
const links = {
  abiweb: {
    title: "Abiweb",
    icon: "/brandweerherentals/icons/buttons/abiweb.png",
    desc: "Oefeningen en prestaties",
    url: "https://identity.brandweerzonekempen.be/Identity/Account/Login?ReturnUrl=%2Fconnect%2Fauthorize%3Fclient_id%3Dabiweb.client.new"
  },
  agenda: {
    title: "Agenda",
    icon: "ðŸ“…",
    desc: "Belangrijke data en evenementen",
    url: "/brandweerherentals/agenda.html"
  },
  defect: {
    title: "Defectmelding",
    icon: "ðŸ”§",
    desc: "Meld defecten aan materiaal of voertuigen",
    url: "https://forms.cloud.microsoft/Pages/ResponsePage.aspx?id=ex_6l868RE6S2t-IkEL0dqocXptaGhNPlV-vS_rmuEtUNTZUNVFFSUQwRldXTkpKREpGVlYyUzIwWC4u"
  },
  kantine: {
    title: "Kantine",
    icon: "ðŸ»",
    desc: "Bestellen & betalen",
    url: "/brandweerherentals/kantine.html"
  },
  logistiek: {
    title: "Logistiek",
    icon: "/brandweerherentals/icons/buttons/winkelkar.png",
    desc: "Transport aanvragen",
    url: "https://form.jotform.com/230682691731055"
  },
  order: {
    title: "Bestelling",
    icon: "ðŸ“¦",
    desc: "Materiaal of verbruiksgoederen bestellen",
    url: "https://forms.cloud.microsoft/e/GjHr1Kym0w"
  },
  vehicle: {
    title: "Voertuigreservatie",
    icon: "ðŸš’",
    desc: "Controle & reservatie",
    url: "https://forms.cloud.microsoft/Pages/ResponsePage.aspx?id=ex_6l868RE6S2t-IkEL0dqocXptaGhNPlV-vS_rmuEtUN0JBTzkySTI0STI0STI0"
  },
  verdi: {
    title: "Verdi",
    icon: "/brandweerherentals/icons/buttons/verdi.png",
    desc: "Oproepen & status",
    url: "https://kempen.verdi.cloud/"
  },
  wegenwerken: {
    title: "Wegenwerken",
    icon: "ðŸš§",
    desc: "Actuele info",
    url: "/brandweerherentals/wegenwerken.html"
  },
  wespen: {
    title: "Wespen",
    icon: "ðŸ",
    desc: "Ploeg van dienst",
    url: "/brandweerherentals/wespen.html"
  }
};

// Extra knop als VZW-lid
if (localStorage.getItem("isVZW") === "true") {
  links.firecrew = {
    title: "Firecrew",
    icon: "ðŸ”¥",
    desc: "Exclusieve ledenpagina",
    url: "/brandweerherentals/firecrew.html"
  };
}


// =====================================================================================
// ðŸ–¼ï¸ KNOPPEN RENDEREN
// =====================================================================================
const sorted = Object.values(links).sort((a, b) =>
  a.title.localeCompare(b.title, "nl")
);

const grid = document.getElementById("buttonGrid");

sorted.forEach(item => {
  const a = document.createElement("a");
  a.className = "btn";
  a.href = item.url;

  a.innerHTML = `
    <div class="icon">
      ${item.icon.endsWith(".png") ? `<img src="${item.icon}" alt="${item.title}">` : item.icon}
    </div>
    <div>
      <div>${item.title}</div>
      <small>${item.desc}</small>
    </div>
  `;

  grid.appendChild(a);
});


// =====================================================================================
// ðŸ•’ DATUM + PLOEG VAN WEEK
// =====================================================================================
document.addEventListener("DOMContentLoaded", () => {
  const cyclus = ["A1","B1","C1","A2","B2","C2"];
  const referentie = new Date("2025-01-03T12:00:00");

  function currentPloeg() {
    const now = new Date();
    const diff = now - referentie;
    const weken = Math.floor(diff / (7 * 24 * 60 * 60 * 1000));
    const i = ((weken % cyclus.length) + cyclus.length) % cyclus.length;
    return cyclus[i];
  }

  function updateHeader() {
    const options = {
      weekday: "short",
      day: "2-digit",
      month: "short",
      hour: "2-digit",
      minute: "2-digit"
    };
    document.getElementById("datetime").textContent =
      new Date().toLocaleString("nl-BE", options);

    document.getElementById("ploegOfWeek").textContent =
      "Ploeg van week: " + currentPloeg();
  }

  updateHeader();
  setInterval(updateHeader, 1000);
});


// =====================================================================================
// ðŸ“² INSTALLATIE-PROMPT (Android + iPhone detectie)
// =====================================================================================
let deferredPrompt;
const installPrompt = document.getElementById("installPrompt");
const installBtn = document.getElementById("installNow");
const installClose = document.getElementById("installClose");

function showInstall() {
  if (!localStorage.getItem("appInstalled")) {
    installPrompt.style.display = "flex";
  }
}

function hideInstall() {
  installPrompt.style.display = "none";
}

window.addEventListener("beforeinstallprompt", e => {
  e.preventDefault();
  deferredPrompt = e;
  showInstall();
});

installBtn.addEventListener("click", async () => {
  const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);

  if (isIOS) {
    alert("Op iPhone/iPad: gebruik het deel-icoontje en kies â€˜Zet op beginschermâ€™.");  
    hideInstall();
    return;
  }

  if (deferredPrompt) {
    deferredPrompt.prompt();
    const result = await deferredPrompt.userChoice;

    if (result.outcome === "accepted") {
      localStorage.setItem("appInstalled", "true");
    }

    hideInstall();
  }
});

installClose.addEventListener("click", hideInstall);
</script>

</body>
</html>
