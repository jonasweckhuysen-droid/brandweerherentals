<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Brandweer Herentals â€” Portal</title>

<!-- PWA -->
<link rel="manifest" href="/brandweerherentals/manifest.json">
<meta name="theme-color" content="#c71f1f">

<!-- Centrale layout -->
<link rel="stylesheet" href="style.css">

<style>
/* ---------- WELCOME OVERLAY ---------- */
#welcomeOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.65);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

#welcomeOverlay .overlay-content {
  background: #fff;
  border-radius: 16px;
  padding: 24px;
  width: 90%;
  max-width: 400px;
  text-align: center;
  box-shadow: 0 6px 20px rgba(0,0,0,0.2);
}

#welcomeOverlay h2 {
  margin-bottom: 12px;
  color: #c71f1f;
}

#welcomeOverlay input[type=text],
#welcomeOverlay input[type=password] {
  width: 80%;
  padding: 8px 10px;
  margin: 6px 0;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 1rem;
}

#welcomeOverlay .specialiteiten {
  display: flex;
  flex-direction: column;
  text-align: left;
  margin: 12px 0;
}

#welcomeOverlay .specialiteiten label {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 600;
  margin-bottom: 6px;
  cursor: pointer;
}

#welcomeOverlay .specialiteiten input[type=checkbox] {
  width: 18px;
  height: 18px;
  accent-color: #c71f1f;
}

#welcomeOverlay button {
  background: var(--red);
  color: #fff;
  border: none;
  padding: 10px 16px;
  border-radius: 10px;
  font-weight: 700;
  cursor: pointer;
  margin-top: 10px;
}

#welcomeOverlay button:hover {
  background: #e33b3b;
}
</style>
</head>
<body>

<div class="container" role="application" aria-label="Brandweer Herentals portal">

  <!-- HEADER -->
  <header id="appHeader">
    <div class="header-left">
      <img src="/brandweerherentals/icons/logo.png"
           alt="Brandweer Herentals"
           class="header-logo">
    </div>

    <div class="header-right">
      <div id="greeting" class="header-greeting"></div>
      <div id="datetime" class="header-datetime"></div>
      <div id="ploegOfWeek" class="header-ploeg"></div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="content">
    <div class="grid" id="buttonGrid" aria-live="polite"></div>

    <!-- Install PWA prompt -->
    <div id="installPrompt" class="overlay" style="display:none;">
      <div class="overlay-content" role="dialog" aria-modal="true">
        <span id="installText">ðŸ“² Voeg de app toe aan je startscherm</span>
        <button id="installNow">Toevoegen</button>
        <span class="close" id="installClose">âœ–</span>
      </div>
    </div>
  </main>

  <!-- FOOTER -->
  <footer>
    <div>Versie 1.1</div>
    <div></div>
  </footer>
</div>

<!-- ---------- WELCOME OVERLAY HTML ---------- -->
<div id="welcomeOverlay">
  <div class="overlay-content">
    <h2>Welkom bij Brandweer Herentals</h2>
    <input type="text" id="userNameInput" placeholder="Vul je naam in">
    <input type="password" id="vzwInput" placeholder="VZW Firecrew wachtwoord">
    <div class="specialiteiten">
      <label><input type="checkbox" name="specialiteit" value="ambulancier"> Ambulancier</label>
      <label><input type="checkbox" name="specialiteit" value="chauffeur"> Chauffeur</label>
      <label><input type="checkbox" name="specialiteit" value="duiker"> Duiker</label>
      <label><input type="checkbox" name="specialiteit" value="firecrew"> VZW Firecrew</label>
      <label><input type="checkbox" name="specialiteit" value="brandweer"> Brandweer (geen extra knop)</label>
    </div>
    <button id="confirmUserBtn">Bevestigen</button>
  </div>
</div>

<!-- ================================
     SCRIPT
=============================== -->
<script>
const links = {
  abiweb: { title:"Abiweb", icon:"/brandweerherentals/icons/buttons/abiweb.png", desc:"Oefeningen en prestaties", url:"https://identity.brandweerzonekempen.be/Identity/Account/Login?ReturnUrl=%2Fconnect%2Fauthorize%3Fclient_id%3Dabiweb.client.new" },
  agenda: { title:"Agenda", icon:"ðŸ“…", desc:"Belangrijke data en evenementen", url:"/brandweerherentals/agenda.html" },
  defect: { title:"Defectmelding", icon:"ðŸ”§", desc:"Meld defecten", url:"https://forms.cloud.microsoft/Pages/ResponsePage.aspx?id=ex_6l868RE6S2t-IkEL0dqocXptaGhNPlV-vS_rmuEtUNTZUNVFFSUQwRldXTkpKREpGVlYyUzIwWC4u" },
  kantine: { title:"Kantine", icon:"ðŸ»", desc:"Bestellen & betalen", url:"/brandweerherentals/kantine.html" },
  logistiek: { title:"Logistiek", icon:"/brandweerherentals/icons/buttons/winkelkar.png", desc:"Transport aanvragen", url:"https://form.jotform.com/230682691731055" },
  order: { title:"Bestelling", icon:"ðŸ“¦", desc:"Materiaal bestellen", url:"https://forms.cloud.microsoft/e/GjHr1Kym0w" },
  vehicle: { title:"Voertuigreservatie", icon:"ðŸš’", desc:"Controle & reservatie", url:"https://forms.cloud.microsoft/Pages/ResponsePage.aspx?id=ex_6l868RE6S2t-IkEL0dqocXptaGhNPlV-vS_rmuEtUN0JBTzkySTI0STFZUlk4Q01GOVRTR1UzMy4u" },
  verdi: { title:"Verdi", icon:"/brandweerherentals/icons/buttons/verdi.png", desc:"Oproepen", url:"https://kempen.verdi.cloud/" },
  wegenwerken: { title:"Wegenwerken", icon:"ðŸš§", desc:"Actuele info", url:"/brandweerherentals/wegenwerken.html" },
  wespen: { title:"Wespen", icon:"ðŸ", desc:"Ploeg van dienst", url:"/brandweerherentals/wespen.html" }
};

// ===================== RENDER GRID =====================
function renderGrid() {
  const grid = document.getElementById("buttonGrid");
  grid.innerHTML = "";
  Object.values(links).sort((a,b) => a.title.localeCompare(b.title,"nl"))
    .forEach(item => {
      const a = document.createElement("a");
      a.className = "btn";
      a.href = item.url;
      a.innerHTML = `
        <div class="icon">${item.icon.endsWith(".png") ? `<img src="${item.icon}" alt="${item.title}">` : item.icon}</div>
        <div>
          <div>${item.title}</div>
          <small>${item.desc}</small>
        </div>
      `;
      grid.appendChild(a);
    });
}

// ===================== USER OVERLAY =====================
const confirmBtn = document.getElementById("confirmUserBtn");
confirmBtn.addEventListener("click", () => {
  const userNameInput = document.getElementById("userNameInput").value.trim();
  const vzwInput = document.getElementById("vzwInput").value.trim();
  const checkedBoxes = Array.from(document.querySelectorAll('input[name="specialiteit"]:checked'));
  const specialiteiten = checkedBoxes.map(cb => cb.value);

  if (!userNameInput) return alert("Vul je naam in!");

  localStorage.setItem("userName", userNameInput);
  document.getElementById("greeting").textContent = `Welkom, ${userNameInput}!`;

  if (specialiteiten.includes("firecrew") && vzwInput !== "Oudstrijder") {
    alert("Fout wachtwoord voor VZW Firecrew!");
    return;
  }

  localStorage.setItem("isVZW", specialiteiten.includes("firecrew") ? "true" : "false");
  localStorage.setItem("specialiteiten", JSON.stringify(specialiteiten));

  document.getElementById("welcomeOverlay").style.display = "none";

  // Voeg speciale knoppen toe
  if (specialiteiten.includes("ambulancier")) links.ambulance = { title:"Ambulance", icon:"ðŸš‘", desc:"Toegang Ambulance", url:"/brandweerherentals/ambulance.html" };
  if (specialiteiten.includes("chauffeur")) links.chauffeur = { title:"Chauffeur", icon:"ðŸš›", desc:"Toegang Chauffeur", url:"/brandweerherentals/chauffeur.html" };
  if (specialiteiten.includes("duiker")) links.duiker = { title:"Duiker", icon:"ðŸ¤¿", desc:"Toegang Duiker", url:"/brandweerherentals/duiker.html" };
  if (specialiteiten.includes("firecrew")) links.firecrew = { title:"Firecrew", icon:"ðŸ”¥", desc:"Exclusief", url:"/brandweerherentals/firecrew.html" };

  renderGrid();
});

// ===================== INIT =====================
window.addEventListener("DOMContentLoaded", () => {
  // Check of gebruiker al eerder ingevuld heeft
  const savedName = localStorage.getItem("userName");
  const savedSpec = JSON.parse(localStorage.getItem("specialiteiten") || "[]");

  if (savedName) {
    document.getElementById("userNameInput").value = savedName;
    document.getElementById("greeting").textContent = `Welkom, ${savedName}!`;
  }

  savedSpec.forEach(spec => {
    if (spec !== "brandweer") {
      const cb = document.querySelector(`input[name="specialiteit"][value="${spec}"]`);
      if (cb) cb.checked = true;
      // Voeg knop direct toe
      if (spec === "ambulancier") links.ambulance = { title:"Ambulance", icon:"ðŸš‘", desc:"Toegang Ambulance", url:"/brandweerherentals/ambulance.html" };
      if (spec === "chauffeur") links.chauffeur = { title:"Chauffeur", icon:"ðŸš›", desc:"Toegang Chauffeur", url:"/brandweerherentals/chauffeur.html" };
      if (spec === "duiker") links.duiker = { title:"Duiker", icon:"ðŸ¤¿", desc:"Toegang Duiker", url:"/brandweerherentals/duiker.html" };
      if (spec === "firecrew") links.firecrew = { title:"Firecrew", icon:"ðŸ”¥", desc:"Exclusief", url:"/brandweerherentals/firecrew.html" };
    }
  });

  renderGrid();
});

// ===================== PWA INSTALL PROMPT =====================
let deferredPrompt;
const installPrompt = document.getElementById("installPrompt");
const installBtn = document.getElementById("installNow");
const installClose = document.getElementById("installClose");

window.addEventListener("beforeinstallprompt", e => {
  e.preventDefault();
  deferredPrompt = e;
  installPrompt.style.display = "flex";
});

installBtn.addEventListener("click", async () => {
  const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
  if (isIOS) { alert("Op iPhone/iPad: gebruik â€˜Zet op beginschermâ€™."); installPrompt.style.display="none"; return; }
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const result = await deferredPrompt.userChoice;
    if(result.outcome==="accepted") localStorage.setItem("appInstalled","true");
    installPrompt.style.display="none";
  }
});

installClose.addEventListener("click", ()=>installPrompt.style.display="none");
</script>

<!-- Header script -->
<script src="/brandweerherentals/header.js"></script>

</body>
</html>
