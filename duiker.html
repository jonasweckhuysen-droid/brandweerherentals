<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Duiker â€” Brandweer Herentals</title>
  <link rel="stylesheet" href="style.css">

  <style>
    body {
      background: #111;
      color: white;
      font-family: sans-serif;
    }
    .duik-card {
      background: #222;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      border-left: 5px solid #0b5ed7;
    }
    .duiker-rij {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px solid #333;
    }
    .duiker-naam {
      font-weight: bold;
    }
    .duiker-functie {
      font-size: 0.9rem;
      opacity: 0.7;
    }
    .status-btn {
      padding: 4px 8px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
      min-width: 70px;
    }
    .status-onbekend { background: #7f8c8d; color: white; }
    .status-yes { background: #2ecc71; color: white; }
    .status-no { background: #e74c3c; color: white; }
  </style>
</head>
<body>
<div class="container">

  <header id="appHeader">
    <div class="header-left">
      <img src="/brandweerherentals/icons/logo.png" class="header-logo" alt="">
    </div>
    <div class="header-right">
      <div id="greeting" class="header-greeting"></div>
      <div id="datetime" class="header-datetime"></div>
      <div id="ploegOfWeek" class="header-ploeg"></div>
    </div>
  </header>

  <main>
    <h2>ğŸ¤¿ Duikagenda & Aanwezigheid</h2>
    <p>Zet hier je aanwezigheid bij de duikoefeningen.</p>
    <div id="duikAgendaContainer"></div>

    <a href="index.html" class="backlink">â† Terug naar menu</a>
  </main>

  <footer><div>Brandweer Herentals</div></footer>
</div>

<script src="/brandweerherentals/header.js"></script>

<!-- Firebase compat -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // ===============================
  // Firebase initialisatie
  // ===============================
  const firebaseConfig = {
    apiKey: "AIzaSyAUkFsXiJ7MOIDFfC0AUk9DiT_BPIHzfEE",
    authDomain: "post-herentals.firebaseapp.com",
    databaseURL: "https://post-herentals-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "post-herentals",
    storageBucket: "post-herentals.firebasestorage.app",
    messagingSenderId: "762725561089",
    appId: "1:762725561089:web:38c46cccf44d624252100",
    measurementId: "G-C2FWECFEQX"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ===============================
  // Duikteam
  // ===============================
  const duikers = [
    { naam: "Bart Boons", functie: "Duiker" },
    { naam: "Jef Leysen", functie: "Duiker" },
    { naam: "Wannes Verhegge", functie: "Duiker" },
    { naam: "Jonas Weckhuysen", functie: "Duiker" },
    { naam: "Danny Van den Bergh", functie: "Assistent" },
    { naam: "Patrick Van Hove", functie: "Assistent" },
    { naam: "Alain Leemans", functie: "Assistent" },
    { naam: "Kurt Cools", functie: "Assistent" },
    { naam: "Pedro Wallyn", functie: "Assistent" }
  ];

  // ===============================
  // Hardcoded duikagenda 2026
  // ===============================
  const duikAgenda = [
    { datum:"25/01/2026", uur:"9:00", plaats:"LILSE BERGEN", oef:"IJSDUIK OF/EN MATERIAALTEST" },
    { datum:"08/02/2026", uur:"9:00", plaats:"ALBERT KANAAL", oef:"ZOEKMETHODES" },
    { datum:"15/03/2026", uur:"9:00", plaats:"ALBERT KANAAL", oef:"SEINLIJNEN BEDIENEN" },
    { datum:"12/04/2026", uur:"9:00", plaats:"ALBERT KANAAL", oef:"SCENARIO" },
    { datum:"31/05/2026", uur:"9:00", plaats:"ALBERT KANAAL", oef:"ZOEKMETHODES" },
    { datum:"15/06/2026", uur:"19:00", plaats:"GROBBENDONK", oef:"ZONEDUIK" },
    { datum:"28/06/2026", uur:"9:00", plaats:"ALBERT KANAAL", oef:"SLEPEN POP" },
    { datum:"19/07/2026", uur:"9:00", plaats:"ALBERT KANAAL", oef:"SCENARIO" },
    { datum:"23/08/2026", uur:"9:00", plaats:"ALBERT KANAAL", oef:"ZOEKMETHODES" },
    { datum:"13/09/2026", uur:"9:00", plaats:"ALBERT KANAAL", oef:"AUTO TE WATER" },
    { datum:"30/09/2026", uur:"19:00", plaats:"MOL", oef:"ZONEDUIK" },
    { datum:"04/10/2026", uur:"9:00", plaats:"ALBERT KANAAL", oef:"SEINLIJNEN BEDIENEN" },
    { datum:"08/11/2026", uur:"9:00", plaats:"ALBERT KANAAL", oef:"SLEPEN POP" },
    { datum:"11/12/2026", uur:"19:00", plaats:"JACHTHAVEN", oef:"DUIKEN MET VERLICHTING" }
  ];

  // ===============================
  // Functie om safe Firebase keys te maken
  // ===============================
  function makeSafeKey(str) {
    return str.replace(/[.#$/[\]]/g,"_").replace(/ /g,"_");
  }

  // ===============================
  // Genereren agenda + aanwezigheidsknoppen
  // ===============================
  function renderAgenda() {
    const container = document.getElementById("duikAgendaContainer");
    container.innerHTML = "";

    duikAgenda.forEach(entry => {
      const dateKey = makeSafeKey(`${entry.datum}_${entry.uur}`);

      const card = document.createElement("div");
      card.className = "duik-card";

      const h3 = document.createElement("h3");
      h3.textContent = `ğŸ“… ${entry.datum} â€” ${entry.uur}`;
      card.appendChild(h3);

      const info = document.createElement("div");
      info.style.marginBottom = "10px";
      info.innerHTML = `ğŸ“ <strong>Locatie:</strong> ${entry.plaats}<br>ğŸ“ <strong>Oefening:</strong> ${entry.oef}`;
      card.appendChild(info);

      duikers.forEach(d => {
        const safeName = makeSafeKey(d.naam);

        const row = document.createElement("div");
        row.className = "duiker-rij";

        const nameSpan = document.createElement("span");
        nameSpan.innerHTML = `<span class="duiker-naam">${d.naam}</span> <span class="duiker-functie">(${d.functie})</span>`;

        const btn = document.createElement("button");
        btn.className = "status-btn status-onbekend";
        btn.innerText = "â€¦";

        const dbRef = db.ref(`duikAanwezig/${dateKey}/${safeName}`);

        // live update
        dbRef.on("value", snap => {
          const v = snap.val();
          if (v === true) {
            btn.className = "status-btn status-yes";
            btn.innerText = "Aanwezig";
          } else if (v === false) {
            btn.className = "status-btn status-no";
            btn.innerText = "Afwezig";
          } else {
            btn.className = "status-btn status-onbekend";
            btn.innerText = "â€¦";
          }
        });

        btn.onclick = () => {
          dbRef.get().then(snap => {
            const v = snap.val();
            dbRef.set(v === true ? false : true);
          });
        };

        row.appendChild(nameSpan);
        row.appendChild(btn);
        card.appendChild(row);
      });

      container.appendChild(card);
    });
  }

  // Start rendering
  renderAgenda();
</script>

</body>
</html>
