<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chauffeur Oefenmomenten ‚Äî Brandweer Herentals</title>

<style>
body { margin:0; font-family: Arial, sans-serif; background:#f2f4f7; }
.container { max-width:900px; margin:0 auto 20px auto; background:#fff; border-radius:15px; box-shadow:0 6px 15px rgba(0,0,0,0.1); padding:0 20px 20px 20px; }
header#appHeader { display:flex; justify-content:space-between; align-items:center; background:#c62828; color:white; margin:-20px -20px 0 -20px; padding:15px 20px; border-radius:15px 15px 0 0; }
.header-left, .header-right { display:flex; align-items:center; }
.header-logo { height:50px; }
.header-greeting { margin-left:10px; font-weight:bold; color:white; }
.backlink { text-decoration:none; font-weight:600; display:inline-block; margin:25px 0 20px 0; color:white; background:#c62828; padding:6px 12px; border-radius:8px; }
#searchInput { padding:10px 12px; border-radius:10px; border:1px solid #ccc; font-size:1rem; margin-bottom:20px; width:100%; }
.chauffeur-card { background:#f9f9f9; padding:15px; border-radius:12px; margin-bottom:20px; border-left:6px solid #c62828; }
.chauffeur-card h3 { display:flex; justify-content:space-between; align-items:center; }
.counter { font-size:0.9rem; color:#555; }
.vehicle { margin-top:10px; padding:10px; border:1px solid #eee; border-radius:12px; background:#fff; }
.veh-header { font-weight:bold; margin-bottom:8px; }
.exercise-list label { display:block; margin-bottom:4px; }
.error { background:#ffebee; padding:15px; border-radius:10px; color:#b71c1c; font-weight:bold; }
</style>
</head>

<body>

<div class="container">

<header id="appHeader">
  <div class="header-left">
    <img src="/brandweerherentals/icons/logo.png" class="header-logo">
    <div id="greeting" class="header-greeting"></div>
  </div>
</header>

<main>
  <a href="index.html" class="backlink">‚Üê Terug naar menu</a>
  <input type="text" id="searchInput" placeholder="Zoek op naam...">
  <div id="chauffeurContainer"></div>
</main>

</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.30.0/firebase-database-compat.js"></script>

<script>
firebase.initializeApp({
  databaseURL: "https://bwhchauffeur-default-rtdb.europe-west1.firebasedatabase.app/"
});
const database = firebase.database();

// ================== LOGIN ==================
let loggedInUser = localStorage.getItem("userName");

if(!loggedInUser){
  loggedInUser = prompt("Geef je naam exact in zoals geregistreerd:");
  if(loggedInUser) localStorage.setItem("userName", loggedInUser.trim());
}

loggedInUser = (loggedInUser || "").trim();

// ================== ADMINS ==================
const admins = [
  "Patrick Van Hove",
  "Alain Leemans",
  "Jonas Weckhuysen",
  "Danny Van Den Bergh"
];

const isAdmin = admins.includes(loggedInUser);

// ================== DATA ==================
const chauffeurs = [
"Dries Boven","Robin Buyens","Bart Cools","Kurt Cools","Gianni Cornelis",
"Roel Dekort","Rik Goris","Kris Hoeylaerts","Philippe Hoeylaerts","Vincent Leemans",
"Bart Leten","Steven Maes","Liese Meyskens","Rutger Moons","Sven Van Buren",
"Jakke Van den Broeck","Kris Van Looveren","No√´l Van Roy","Joris Van Vracem",
"Cristoph Verhaegen","Robbe Vervecken","Steven Vervloet"
];

if(!isAdmin && !chauffeurs.includes(loggedInUser)){
  document.getElementById("chauffeurContainer").innerHTML = `
    <div class="error">
      ‚ùå Gebruiker "<b>${loggedInUser}</b>" niet gevonden in chauffeurslijst.<br><br>
      Controleer je spelling of neem contact op met de beheerder.
    </div>
  `;
  document.getElementById("greeting").textContent = `Onbekende gebruiker`;
  throw new Error("User not found");
}

document.getElementById("greeting").textContent = 
  isAdmin ? `Admin: ${loggedInUser}` : `Welkom ${loggedInUser}`;

// ================== OEFENMOMENTEN ==================
const oefenmomenten = {
  "B541":[1,2,3,4,5,6],
  "L544":[1,2,3,4],
  "L549":[1,2,3,4,5],
  "A545":[1,2,3,4,5,6],
  "D541":[1,2,3],
  "M545":[1,2,3,4],
  "T545":[1,2,3,4,5,6],
  "H541":[1,2,3,4,5,6],
  "A541":[1,2,3,4,5,6],
  "Containers":[1]
};

// ================== GROEPEN ==================
const mid = Math.ceil(chauffeurs.length/2);
const groep1 = chauffeurs.slice(0, mid);

const voorjaarSetA = ["B541","L544","L549","A545","D541","M545"];
const najaarSetA  = ["T545","H541","A541","Containers"];

const maand = new Date().getMonth()+1;
const isVoorjaar = maand <= 6;
const evenYear = new Date().getFullYear() % 2 === 0;

function getVoertuigen(chauffeur){
  const inGroep1 = groep1.includes(chauffeur);
  if(inGroep1){
    return isVoorjaar ? (evenYear ? najaarSetA : voorjaarSetA) : (evenYear ? voorjaarSetA : najaarSetA);
  }
  return isVoorjaar ? (evenYear ? voorjaarSetA : najaarSetA) : (evenYear ? najaarSetA : voorjaarSetA);
}

// ================== RENDER ==================
const container = document.getElementById("chauffeurContainer");

function renderChauffeurs(filter=""){
  container.innerHTML="";
  filter = filter.toLowerCase();

  chauffeurs.forEach(chauffeur => {

    if(!isAdmin && chauffeur !== loggedInUser) return;
    if(filter && !chauffeur.toLowerCase().includes(filter)) return;

    const voertuigen = getVoertuigen(chauffeur);

    const card = document.createElement("div");
    card.className = "chauffeur-card";

    const hold = document.createElement("span");
    hold.className = "counter";

    const title = document.createElement("h3");
    title.textContent = chauffeur;
    title.appendChild(hold);
    card.appendChild(title);

    voertuigen.forEach(voertuig => {
      const blok = document.createElement("div");
      blok.className = "vehicle";

      const vertr = document.createElement("div");
      vertr.className = "veh-header";
      vertr.textContent = "üöí " + voertuig;
      blok.appendChild(vertr);

      const lijst = document.createElement("div");
      lijst.className = "exercise-list";

      oefenmomenten[voertuig]?.forEach((num) => {
        const label = document.createElement("label");
        const cb = document.createElement("input");
        cb.type = "checkbox";

        const ref = database.ref(`oefenmomenten/${chauffeur}/${voertuig}_${num}`);

        ref.on("value", s=>{
          cb.checked = s.val() === true;
          updateCounter();
        });

        cb.addEventListener("change",()=>{
          ref.set(cb.checked);
        });

        label.appendChild(cb);
        label.append(" Oefenmoment "+num);
        lijst.appendChild(label);
      });

      blok.appendChild(lijst);
      card.appendChild(blok);
    });

    function updateCounter(){
      const done = card.querySelectorAll(".exercise-list input:checked").length;
      const total = card.querySelectorAll(".exercise-list input").length;
      hold.textContent = ` ${done}/${total}`;
    }

    container.appendChild(card);
  });
}

renderChauffeurs();
document.getElementById("searchInput").oninput = e => renderChauffeurs(e.target.value);

</script>

</body>
</html>
