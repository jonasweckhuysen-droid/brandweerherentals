<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chauffeur Oefenmomenten ‚Äî Brandweer Herentals</title>
<link rel="stylesheet" href="style.css">
</head>

<body>

<div class="container">

  <!-- HEADER -->
  <header id="appHeader">
    <div class="header-left">
      <img src="/brandweerherentals/icons/logo.png" alt="Brandweer Herentals" class="header-logo">
    </div>
    <div class="header-right">
      <div id="greeting" class="header-greeting"></div>
      <div id="datetime" class="header-datetime"></div>
      <div id="ploegOfWeek" class="header-ploeg"></div>
    </div>
  </header>

  <main>
    <a href="index.html" class="backlink">‚Üê Terug naar menu</a>
    <input type="text" id="searchInput" placeholder="Zoek op naam...">
    <div id="chauffeurContainer"></div>
  </main>

</div>

<script>
/* =================== GEBRUIKER =================== */
const huidigeGebruiker = localStorage.getItem("userName") || "Onbekend";
document.getElementById("greeting").textContent = `Welkom ${huidigeGebruiker}`;

/* =================== DATUM & TIJD =================== */
function updateDateTime(){
  const now = new Date();
  document.getElementById("datetime").textContent = now.toLocaleString("nl-BE");
}
setInterval(updateDateTime, 1000);
updateDateTime();

/* =================== PLOEG VAN DE WEEK =================== */
const ploegen = ["Ploeg A", "Ploeg B", "Ploeg C", "Ploeg D"];
// voorbeeld: weeknummer modulo aantal ploegen
const weekNum = Math.ceil((new Date() - new Date(new Date().getFullYear(),0,1))/604800000);
document.getElementById("ploegOfWeek").textContent = `Ploeg van de week: ${ploegen[weekNum % ploegen.length]}`;

/* =================== ADMINS =================== */
const admins = ["Patrick Van Hove","Alain Leemans","Jonas Weckhuysen","Danny Van Den Bergh"];
const isAdmin = admins.includes(huidigeGebruiker);

/* =================== CHAUFFEURS =================== */
const chauffeurs = [
  "Dries Boven", "Robin Buyens", "Bart Cools", "Kurt Cools", "Gianni Cornelis",
  "Roel Dekort", "Rik Goris", "Kris Hoeylaerts", "Philippe Hoeylaerts", "Vincent Leemans",
  "Bart Leten", "Steven Maes", "Liese Meyskens", "Rutger Moons", "Sven Van Buren",
  "Jakke Van den Broeck", "Kris Van Looveren", "No√´l Van Roy", "Joris Van Vracem",
  "Cristoph Verhaegen", "Robbe Vervecken", "Steven Vervloet"
];

/* =================== OEFENMOMENTEN =================== */
const oefenmomenten = {
  "B541":[1,2,3,4,5,6],
  "L544":[1,2,3,4],
  "L549":[1,2,3,4,5],
  "A545":[1,2,3,4,5,6],
  "D541":[1,2,3],
  "M545":[1,2,3,4],
  "T545":[1,2,3,4,5,6],
  "H541":[1,2,3,4,5,6],
  "A541":[1,2,3,4,5,6],
  "Containers":[1]
};

/* =================== GROEPEN & SETS =================== */
const mid = Math.ceil(chauffeurs.length / 2);
const groep1 = chauffeurs.slice(0, mid);
const groep2 = chauffeurs.slice(mid);

// **SETS OMGEWISSELD VOOR SEIZOEN**
const setA = ["T545","H541","A541","Containers"];
const setB = ["B541","L544","L549","A545","D541","M545"];

const maand = new Date().getMonth() + 1;
const isVoorjaar = maand <= 6;

function getVoertuigenVoorChauffeur(chauffeur){
  if (groep1.includes(chauffeur)) {
    return isVoorjaar ? setB : setA;
  } else {
    return isVoorjaar ? setA : setB;
  }
}

/* =================== RENDER MET TELLER =================== */
const containerDiv = document.getElementById("chauffeurContainer");

function renderChauffeurs(filter=""){
  containerDiv.innerHTML="";
  filter = filter.toLowerCase();

  chauffeurs.forEach(chauffeur=>{
    if(!isAdmin && chauffeur !== huidigeGebruiker) return;
    if(filter && !chauffeur.toLowerCase().includes(filter)) return;

    const voertuigen = getVoertuigenVoorChauffeur(chauffeur);
    const card = document.createElement("div");
    card.className="chauffeur-card";

    const h3 = document.createElement("h3");
    h3.textContent = chauffeur + " ";
    const counter = document.createElement("span");
    counter.className = "counter";
    counter.textContent = "0 / 0 oefenmomenten voltooid";
    h3.appendChild(counter);
    card.appendChild(h3);

    let totaleOefenmomenten = 0;
    let voltooideOefenmomenten = 0;

    voertuigen.forEach(voertuig=>{
      if(!oefenmomenten[voertuig]) return;
      totaleOefenmomenten += oefenmomenten[voertuig].length;

      const vehicleDiv = document.createElement("div");
      vehicleDiv.className = "vehicle";

      const vehHeader = document.createElement("div");
      vehHeader.className = "veh-header";

      const vehLeft = document.createElement("div");
      vehLeft.className = "veh-left";
      vehLeft.textContent = "üöí " + voertuig;

      const selectAllLabel = document.createElement("label");
      selectAllLabel.className = "select-all-label";

      const selectAllCheckbox = document.createElement("input");
      selectAllCheckbox.type = "checkbox";

      selectAllLabel.appendChild(selectAllCheckbox);
      selectAllLabel.appendChild(document.createTextNode(" Alles aanduiden"));

      vehHeader.appendChild(vehLeft);
      vehHeader.appendChild(selectAllLabel);
      vehicleDiv.appendChild(vehHeader);

      const exerciseDiv = document.createElement("div");
      exerciseDiv.className = "exercise-list";

      const checkboxes = [];

      oefenmomenten[voertuig].forEach(num=>{
        const label = document.createElement("label");
        const input = document.createElement("input");
        input.type="checkbox";
        checkboxes.push(input);

        label.appendChild(input);
        label.appendChild(document.createTextNode(` Oefenmoment ${num}`));
        exerciseDiv.appendChild(label);

        input.addEventListener("change", () => {
          voltooideOefenmomenten = checkboxes.filter(cb => cb.checked).length;
          counter.textContent = `${voltooideOefenmomenten} / ${totaleOefenmomenten} oefenmomenten voltooid`;
        });
      });

      selectAllCheckbox.addEventListener("change", () => {
        checkboxes.forEach(cb => cb.checked = selectAllCheckbox.checked);
        voltooideOefenmomenten = checkboxes.filter(cb => cb.checked).length;
        counter.textContent = `${voltooideOefenmomenten} / ${totaleOefenmomenten} oefenmomenten voltooid`;
      });

      vehicleDiv.appendChild(exerciseDiv);
      card.appendChild(vehicleDiv);
    });

    counter.textContent = `${voltooideOefenmomenten} / ${totaleOefenmomenten} oefenmomenten voltooid`;
    containerDiv.appendChild(card);
  });

  if(!containerDiv.hasChildNodes()){
    containerDiv.innerHTML="<div style='color:#666;padding:12px;border-radius:8px;background:#fff;border:1px dashed #ddd;'>Geen chauffeurs gevonden of geen rechten.</div>";
  }
}

renderChauffeurs();
document.getElementById("searchInput").addEventListener("input", e => renderChauffeurs(e.target.value));

</script>

</body>
</html>
