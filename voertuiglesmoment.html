<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chauffeur Oefenmomenten ‚Äî Brandweer Herentals</title>

<link rel="stylesheet" href="style.css">

<style>
.container {
  max-width:900px;
  margin:0 auto 20px auto;
  background:#fff;
  border-radius:20px;
  box-shadow:0 6px 15px rgba(0,0,0,0.1);
  overflow:hidden;
}

#appHeader {
  background:#c62828;
  color:white;
  padding:15px 20px;
  display:flex;
  align-items:center;
  gap:20px;
  border-radius:20px 20px 0 0;
}

.header-logo {
  height:60px;
}

.header-text {
  display:flex;
  flex-direction:column;
  gap:3px;
}

.backlink {
  display:inline-block;
  margin:20px 0 10px 0;
  padding:6px 12px;
  background:#c62828;
  color:white;
  font-weight:600;
  border-radius:8px;
  text-decoration:none;
}

#searchInput {
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #ccc;
  margin-bottom:15px;
}

.chauffeur-card {
  background:#f9f9f9;
  padding:15px;
  border-radius:12px;
  margin-bottom:20px;
  border-left:6px solid #c62828;
}

.vehicle {
  margin-top:10px;
  padding:10px;
  border-radius:12px;
  border:1px solid #eee;
  background:white;
}

.veh-header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-weight:600;
  margin-bottom:5px;
}

.exercise-list label {
  display:block;
  margin-bottom:4px;
}

.select-all-label {
  font-size:0.85rem;
  display:flex;
  align-items:center;
  gap:5px;
}
</style>
</head>
<body>

<div class="container">

<header id="appHeader">
  <img src="/brandweerherentals/icons/logo.png" class="header-logo">
  <div class="header-text">
    <div id="greeting"></div>
    <div id="datetime"></div>
    <div id="ploegOfWeek"></div>
  </div>
</header>

<main style="padding:15px;">
  <a href="index.html" class="backlink">‚Üê Terug naar menu</a>
  <input type="text" id="searchInput" placeholder="Zoek op naam...">
  <div id="chauffeurContainer"></div>
</main>
</div>

<script src="header.js"></script>

<!-- Firebase (module) -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

/* ‚úÖ JOUW CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyAUkFsXiJ7MOIDFfC0AUk9DiT_BPIHzfEE",
  authDomain: "post-herentals.firebaseapp.com",
  databaseURL: "https://post-herentals-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "post-herentals",
  storageBucket: "post-herentals.firebasestorage.app",
  messagingSenderId: "762725561089",
  appId: "1:762725561089:web:38c46cc8cf44d624252100",
  measurementId: "G-C2FWECFEQX"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

document.addEventListener("DOMContentLoaded", () => {

const huidigeGebruiker = localStorage.getItem("userName") || "Onbekend";

const admins = ["Patrick Van Hove","Alain Leemans","Jonas Weckhuysen","Danny Van Den Bergh"];
const isAdmin = admins.includes(huidigeGebruiker);

const chauffeurs = [
 "Dries Boven","Robin Buyens","Bart Cools","Kurt Cools","Gianni Cornelis",
 "Roel Dekort","Rik Goris","Kris Hoeylaerts","Philippe Hoeylaerts","Vincent Leemans",
 "Bart Leten","Steven Maes","Liese Meyskens","Rutger Moons","Sven Van Buren",
 "Jakke Van den Broeck","Kris Van Looveren","No√´l Van Roy","Joris Van Vracem",
 "Cristoph Verhaegen","Robbe Vervecken","Steven Vervloet"
];

const oefenmomenten = {
  "B541":[1,2,3,4,5,6],"L544":[1,2,3,4],"L549":[1,2,3,4,5],
  "A545":[1,2,3,4,5,6],"D541":[1,2,3],"M545":[1,2,3,4],
  "T545":[1,2,3,4,5,6],"H541":[1,2,3,4,5,6],"A541":[1,2,3,4,5,6],
  "Containers":[1]
};

const mid = Math.ceil(chauffeurs.length/2);
const groep1 = chauffeurs.slice(0, mid);
const groep2 = chauffeurs.slice(mid);
const setA = ["T545","H541","A541","Containers"];
const setB = ["B541","L544","L549","A545","D541","M545"];
const maand = new Date().getMonth()+1;
const isVoorjaar = maand <= 6;

function getVoertuigenVoorChauffeur(c){
 return groep1.includes(c) ? (isVoorjaar?setB:setA):(isVoorjaar?setA:setB);
}

const containerDiv = document.getElementById("chauffeurContainer");

/* ‚úÖ firebase opslaan */
function saveCheckbox(chauffeur, voertuig, nr, value){
 set(ref(db, `oefenmomenten/${chauffeur}/${voertuig}/${nr}`), value);
}

/* ‚úÖ firebase uitlezen (live) */
function listenCheckbox(chauffeur, voertuig, nr, cb){
 onValue(ref(db, `oefenmomenten/${chauffeur}/${voertuig}/${nr}`), snapshot=>{
   const val = snapshot.val();
   if(val !== null) cb.checked = val;
 });
}

function render(filter=""){
 containerDiv.innerHTML = "";
 filter = filter.toLowerCase();

 chauffeurs.forEach(chauffeur=>{
   if(!isAdmin && chauffeur!==huidigeGebruiker) return;
   if(filter && !chauffeur.toLowerCase().includes(filter)) return;

   const voertuigen = getVoertuigenVoorChauffeur(chauffeur);
   const card = document.createElement("div");
   card.className="chauffeur-card";

   const h3 = document.createElement("h3");
   h3.textContent = chauffeur + " ";
   const counter = document.createElement("span");
   h3.appendChild(counter);
   card.appendChild(h3);

   const allCB = [];
   const totaal = voertuigen.reduce((s,v)=>s+(oefenmomenten[v]?.length||0),0);

   voertuigen.forEach(voertuig=>{
     if(!oefenmomenten[voertuig]) return;

     const vDiv = document.createElement("div");
     vDiv.className="vehicle";

     const vh = document.createElement("div");
     vh.className="veh-header";

     vh.innerHTML = `üöí ${voertuig}`;

     const selectAll = document.createElement("input");
     selectAll.type="checkbox";

     const sLabel = document.createElement("label");
     sLabel.className="select-all-label";
     sLabel.append(selectAll, document.createTextNode(" Alles"));

     vh.appendChild(sLabel);
     vDiv.appendChild(vh);

     const lijst = document.createElement("div");
     lijst.className="exercise-list";

     const vCB = [];

     oefenmomenten[voertuig].forEach(nr=>{
       const label=document.createElement("label");
       const cb=document.createElement("input");
       cb.type="checkbox";

       vCB.push(cb);
       allCB.push(cb);

       listenCheckbox(chauffeur, voertuig, nr, cb);

       cb.addEventListener("change",()=>{
         saveCheckbox(chauffeur, voertuig, nr, cb.checked);
         update();
       });

       label.append(cb, ` Oefenmoment ${nr}`);
       lijst.appendChild(label);
     });

     selectAll.addEventListener("change", ()=>{
       vCB.forEach((cb,i)=>{
         cb.checked = selectAll.checked;
         saveCheckbox(chauffeur, voertuig, oefenmomenten[voertuig][i], cb.checked);
       });
       update();
     });

     vDiv.appendChild(lijst);
     card.appendChild(vDiv);
   });

   function update(){
     counter.textContent = `${allCB.filter(x=>x.checked).length} / ${totaal} voltooid`;
   }

   setInterval(update, 1000);
   containerDiv.appendChild(card);
 });

 if(!containerDiv.hasChildNodes()){
   containerDiv.innerHTML = "<div style='padding:10px;color:#666'>Geen toegang of niets gevonden.</div>";
 }
}

render();

document.getElementById("searchInput").addEventListener("input", e=>render(e.target.value));

});

</script>
</body>
</html>
