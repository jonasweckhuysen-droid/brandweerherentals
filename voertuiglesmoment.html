<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Voertuig oefenmomenten — Brandweer Herentals</title>

<link rel="stylesheet" href="style.css">

<style>
/* ZEKERE HEADER FIX */
#appHeader {
  background: #b30000;
  border-radius: 16px 16px 0 0;
  padding: 15px;
  margin: -15px -15px 10px -15px;
}

#appHeader .header-left,
#appHeader .header-right {
  display: flex;
  align-items: center;
}

#appHeader .header-right {
  flex-direction: column;
  align-items: flex-end;
  color: white;
  font-weight: bold;
}

.header-logo {
  height: 50px;
}

.backlink {
  display: inline-block;
  color: #fff;
  background: #b30000;
  padding: 8px 14px;
  border-radius: 8px;
  text-decoration: none;
  margin: 15px 0 20px 0;
  font-weight: bold;
}

.searchbar {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #ccc;
  margin-bottom: 20px;
}

.card {
  background: #fff;
  padding: 15px;
  border-radius: 16px;
  margin-bottom: 20px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.driver-name {
  font-size: 18px;
  font-weight: bold;
}

.period {
  margin-top: 10px;
  font-weight: bold;
  color: #b30000;
}

.exercise-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 10px;
}

.exercise {
  background: #eee;
  padding: 6px 10px;
  border-radius: 20px;
  cursor: pointer;
  transition: 0.2s;
}

.exercise.done {
  background: #b30000;
  color: white;
  text-decoration: line-through;
}

.info {
  font-size: 13px;
  margin-top: 10px;
  display: none;
  padding: 8px;
  background: #f5f5f5;
  border-radius: 10px;
}

.info-btn {
  cursor: pointer;
  margin-left: 6px;
}

footer {
  text-align: center;
  padding: 15px;
  color: #888;
}
</style>
</head>

<body>
<div class="container">

<header id="appHeader">
  <div class="header-left">
    <img src="/brandweerherentals/icons/logo.png" class="header-logo">
  </div>

  <div class="header-right">
    <div id="greeting"></div>
    <div id="datetime"></div>
    <div id="ploegOfWeek"></div>
  </div>
</header>

<a href="chauffeur.html" class="backlink">← Terug naar Chauffeur module</a>

<input type="text" id="searchInput" class="searchbar" placeholder="Zoek op naam...">

<div id="driversContainer"></div>

<footer>
  Brandweer Herentals
</footer>

<script src="/brandweerherentals/header.js"></script>

<script>

/* ===================== ADMINS ===================== */
const admins = [
  "Alain Leemans",
  "Danny Van den Bergh",
  "Patrick Van Hove",
  "Jonas Weckhuysen"
];

let loggedInUser = localStorage.getItem("username");

if (!loggedInUser || loggedInUser.trim() === "") {
  loggedInUser = prompt("Geef je naam in (exact zoals geregistreerd):");
  if (loggedInUser) {
    localStorage.setItem("username", loggedInUser);
  }
}

/* ===================== DATA ===================== */
const drivers = [
  { name: "Dries Boven", group: 2 },
  { name: "Robin Buyens", group: 2 },
  { name: "Bart Cools", group: 2 },
  { name: "Kurt Cools", group: 2 },
  { name: "Gianni Cornelis", group: 1 },
  { name: "Roel Dekort", group: 1 },
  { name: "Rik Goris", group: 1 },
  { name: "Kris Hoeylaerts", group: 1 }
];

/* ===================== PERIODE ===================== */
function getPeriod() {
  const now = new Date();
  const month = now.getMonth() + 1;
  return (month <= 6) ? "voorjaar" : "najaar";
}

const voorjaarA = ["B541","L544","L549","A545","D541","M541"];
const voorjaarB = ["T545","H541","A541","Containers"];

const najaarA  = voorjaarB;
const najaarB  = voorjaarA;

function getExercises(group) {
  const period = getPeriod();

  if (group === 1) {
    return (period === "voorjaar") ? voorjaarB : najaarB;
  } else {
    return (period === "voorjaar") ? voorjaarA : najaarA;
  }
}

function canView(driver) {
  if (admins.includes(loggedInUser)) return true;
  return driver.name === loggedInUser;
}

/* ===================== LOCAL STORAGE ===================== */
function toggleExercise(el, driver, ex) {
  el.classList.toggle("done");

  let data = JSON.parse(localStorage.getItem("oefeningen") || "{}");
  if(!data[driver]) data[driver] = [];

  if (data[driver].includes(ex)) {
    data[driver] = data[driver].filter(e => e !== ex);
  } else {
    data[driver].push(ex);
  }

  localStorage.setItem("oefeningen", JSON.stringify(data));
}

function isDone(driver, ex) {
  const data = JSON.parse(localStorage.getItem("oefeningen") || "{}");
  return data[driver]?.includes(ex);
}

/* ===================== RENDER ===================== */
function renderDrivers(list) {
  const container = document.getElementById("driversContainer");
  container.innerHTML = "";

  list.forEach(d => {
    if (!canView(d)) return;

    const exercises = getExercises(d.group);

    const div = document.createElement("div");
    div.className = "card";

    div.innerHTML = `
      <div class="driver-name">${d.name}</div>
      <div class="period">${getPeriod().toUpperCase()} 2025</div>

      <div class="exercise-list">
        ${exercises.map(e => `
          <div
            class="exercise ${isDone(d.name, e) ? "done" : ""}"
            onclick="toggleExercise(this,'${d.name}','${e}')"
          >
            ${e} 
            <span class="info-btn" onclick="event.stopPropagation();toggleInfo(this)">ℹ️</span>
            <div class="info">Oefenmoment voor ${e}</div>
          </div>
        `).join("")}
      </div>
    `;

    container.appendChild(div);
  });

  if(container.innerHTML.trim() === ""){
    container.innerHTML = "<p style='color:#999;'>Geen chauffeurs gevonden</p>";
  }
}

function toggleInfo(el){
  const info = el.parentElement.querySelector(".info");
  info.style.display = (info.style.display === "block") ? "none" : "block";
}

/* ===================== ZOEKEN ===================== */
document.getElementById("searchInput").addEventListener("keyup", function(){
  const q = this.value.toLowerCase();
  const result = drivers.filter(d => d.name.toLowerCase().includes(q));
  renderDrivers(result);
});

/* ===================== HEADER INFO ===================== */
const greetingEl = document.getElementById("greeting");
greetingEl.textContent = admins.includes(loggedInUser)
    ? `Admin: ${loggedInUser}`
    : `Welkom ${loggedInUser}`;

function updateDateTime(){
  const now = new Date();
  document.getElementById("datetime").textContent =
    now.toLocaleDateString("nl-BE") + " - " + now.toLocaleTimeString("nl-BE");
}
setInterval(updateDateTime, 1000);
updateDateTime();

/* Simpele ploeg berekening */
const ploegen = ["A-ploeg", "B-ploeg", "C-ploeg", "D-ploeg"];
document.getElementById("ploegOfWeek").textContent =
  "Ploeg: " + ploegen[new Date().getWeek?.() % 4 || 0];

/* ===================== START ===================== */
renderDrivers(drivers);

</script>

</div>
</body>
</html>
