<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Wespen — Brandweer Herentals</title>
<link rel="manifest" href="/brandweerherentals/manifest.json">
<meta name="theme-color" content="#c71f1f">
<style>
  /* ... je bestaande CSS blijft ongewijzigd ... */
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
<div class="container" role="application" aria-label="Wespenplanning Herentals">
  <header>
    <div class="logo" aria-hidden="true">BWH</div>
    <div>
      <h1>Wespenverdelging</h1>
      <p>Wie staat op voor de volgende dag</p>
    </div>
  </header>
  <main class="content">
    <a href="/brandweerherentals/" class="back">← Terug naar start</a>
    <div id="wespenList">Laden…</div>
  </main>
  <footer>
    <div class="small">Versie 1.2 —</div>
    <div class="small">Laatste update: <span id="today"></span></div>
  </footer>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("today").textContent =
    new Date().toLocaleDateString("nl-BE", { weekday:"long", year:"numeric", month:"long", day:"numeric" });

  const excelUrl = "/brandweerherentals/data/wespen.xlsx";

  async function loadExcel(url){
    const resp = await fetch(url);
    const arrayBuffer = await resp.arrayBuffer();
    const workbook = XLSX.read(arrayBuffer, { type: "array" });
    const sheetName = workbook.SheetNames[0];
    const sheet = workbook.Sheets[sheetName];
    return XLSX.utils.sheet_to_json(sheet, { header:1 }); // array van arrays
  }

  function parseExcelData(data){
    const today = new Date(); today.setHours(0,0,0,0);
    for(let row of data){
      if(!row || row.length<2) continue;
      const dateStr = row[0]; // verwacht in vorm "dd-mm-yyyy" of "yyyy-mm-dd"
      let date = new Date(dateStr);
      if(isNaN(date.getTime())){
        // probeer nl-formaat "1 november 2025"
        date = new Date(Date.parse(dateStr.replace(/(\d+)\s+([a-z]+)\s+(\d{4})/i, "$2 $1, $3")));
      }
      if(date >= today){
        return {
          raw: row[0],
          ploegcode: row[1],
          names: row.slice(2,6) // verwacht maximaal 4 namen
        };
      }
    }
    return null;
  }

  (async function(){
    const output = document.getElementById("wespenList");
    try{
      const data = await loadExcel(excelUrl);
      const next = parseExcelData(data);
      if(!next){
        output.innerHTML = "<p>Geen toekomstige ploegdagen meer.</p>";
        return;
      }
      const html = `
        <div class="event">
          <div class="event-date">${next.raw}</div>
          <div class="event-title">Ploegcode: ${escapeHtml(next.ploegcode)}</div>
          <div class="event-desc">
            <table class="wespen">
              <tr><td class="col-head">Ploeg 1 - lid 1</td><td>${escapeHtml(next.names[0]||'')}</td></tr>
              <tr><td class="col-head">Ploeg 1 - lid 2</td><td>${escapeHtml(next.names[1]||'')}</td></tr>
              <tr><td class="col-head">Ploeg 2 - lid 1</td><td>${escapeHtml(next.names[2]||'')}</td></tr>
              <tr><td class="col-head">Ploeg 2 - lid 2</td><td>${escapeHtml(next.names[3]||'')}</td></tr>
            </table>
          </div>
        </div>`;
      output.innerHTML = html;
    }catch(err){
      console.error(err);
      output.innerHTML = "<p>Kon Excel niet laden of parsen.</p>";
    }
  })();

  function escapeHtml(s){ return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

});
</script>
</body>
</html>
