<!doctype html>
<html lang="nl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Wespen — Brandweer Herentals</title>
  <link rel="manifest" href="/brandweerherentals/manifest.json">
  <meta name="theme-color" content="#c71f1f">
  <style>
    :root {
      --red: #c71f1f;
      --dark: #111;
      --light: #fff;
      --muted: #f6f6f6;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html, body { margin:0; padding:0; height:100%; }
    body {
      background: linear-gradient(180deg, #fff 0%, #f8f8f8 100%);
      display:flex;
      justify-content:center;
      padding:20px;
      -webkit-font-smoothing:antialiased;
    }
    .container {
      width:100%;
      max-width:780px;
      background: var(--light);
      border-radius:18px;
      border:4px solid var(--red);
      box-shadow:0 8px 30px rgba(0,0,0,0.08);
      overflow:hidden;
    }
    header {
      display:flex;
      align-items:center;
      gap:12px;
      padding:18px;
      background: linear-gradient(90deg, var(--red), #8f1515);
      color: var(--light);
    }
    header .logo {
      width:52px;
      height:52px;
      border-radius:10px;
      background: rgba(255,255,255,0.08);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:700;
      font-size:20px;
    }
    header h1 { margin:0; font-size:18px; }
    header p { margin:0; font-size:12px; opacity:0.9; }
    .content { padding:18px; }
    .event {
      background: var(--muted);
      border-radius:12px;
      padding:14px;
      margin-bottom:12px;
    }
    .event-date { font-weight:700; color:var(--red); font-size:15px; }
    .event-title { font-size:16px; font-weight:600; }
    .event-desc { font-size:14px; opacity:0.8; }
    a.back { color:var(--red); font-weight:700; text-decoration:none; display:inline-block; margin-bottom:12px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">BWH</div>
      <div>
        <h1>Wespenploegen</h1>
        <p>Brandweer Herentals</p>
      </div>
    </header>
    <main class="content">
      <a href="/brandweerherentals/" class="back">← Terug naar start</a>
      <div id="wespenInfo">Laden…</div>
    </main>
  </div>

  <!-- pdf.js (van CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

  <script>
    const PDF_URL = "https://brandweerzonekempen-my.sharepoint.com/:b:/g/personal/jowe210_bwzk_be/Ef1iAUy_xMxJgLxdXQypfGoBJok_9fhc27ng9wjk7RSCUQ?e=FuJQIb";

    async function leesPDF(url) {
      const loadingTask = pdfjsLib.getDocument(url);
      const pdf = await loadingTask.promise;
      let text = "";

      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        const pageText = content.items.map(it => it.str).join(" ");
        text += pageText + "\n";
      }
      return text;
    }

    function parseTabel(pdfText) {
      const lines = pdfText.split(/\n|(?=\d{2}\/\d{2}\/\d{4})/).map(l => l.trim()).filter(Boolean);
      const data = [];
      for (const line of lines) {
        // Verwacht bv: "02/05/2025 A Jan Peeters Koen De Smet Tom Wouters Sarah Vermeer"
        const parts = line.split(/\s+/);
        if (parts.length >= 6) {
          const [dag, maand, jaar] = parts[0].split("/");
          const datum = new Date(`${jaar}-${maand}-${dag}`);
          const ploeg = parts[1];
          const leden = parts.slice(2);
          data.push({ datum, ploeg, leden });
        }
      }
      return data;
    }

    function toonVolgendePloeg(data) {
      const vandaag = new Date();
      const toekomstige = data.filter(d => d.datum >= vandaag).sort((a,b) => a.datum - b.datum);
      return toekomstige.length ? toekomstige[0] : null;
    }

    async function laadWespen() {
      const div = document.getElementById("wespenInfo");
      div.innerHTML = "Laden…";

      try {
        const tekst = await leesPDF(PDF_URL);
        const tabel = parseTabel(tekst);
        const volgende = toonVolgendePloeg(tabel);

        if (!volgende) {
          div.innerHTML = "<p>Geen toekomstige ploegen gevonden.</p>";
          return;
        }

        const datumTekst = volgende.datum.toLocaleDateString("nl-BE", { weekday:"long", year:"numeric", month:"long", day:"numeric" });
        div.innerHTML = `
          <div class="event">
            <div class="event-date">Volgende ploeg: ${datumTekst}</div>
            <div class="event-title">Ploeg ${volgende.ploeg}</div>
            <div class="event-desc">${volgende.leden.join(", ")}</div>
          </div>
        `;
      } catch (err) {
        console.error("Fout bij laden of lezen PDF:", err);
        div.innerHTML = "<p>Kon de PDF niet inladen. Controleer of de link publiek toegankelijk is.</p>";
      }
    }

    document.addEventListener("DOMContentLoaded", laadWespen);
  </script>
</body>
</html>
