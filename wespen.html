<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wespenploegen</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>
</head>
<body>
  <header>
    <h1>Wespenverdelging</h1>
  </header>

  <main>
    <p id="status">Laden van ploegen...</p>
    <div id="ploegen-container"></div>
  </main>

  <script>
    const pdfUrl = "data/wespen.pdf";

    async function leesPDF() {
      try {
        const pdf = await pdfjsLib.getDocument(pdfUrl).promise;
        let tekst = "";

        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const content = await page.getTextContent();
          tekst += content.items.map(item => item.str).join(" ");
        }

        // Tekst opschonen
        tekst = tekst.replace(/\s+/g, " ").trim();

        // Zoek naar datum-patronen (zoals 01/05/2025)
        const regex = /(\d{2}\/\d{2}\/\d{4})/g;
        const alleDatums = [...tekst.matchAll(regex)].map(m => m[1]);

        if (alleDatums.length === 0) {
          document.getElementById("status").textContent = "Geen datums gevonden in PDF.";
          return;
        }

        // Zoek dichtstbijzijnde toekomstige datum
        const vandaag = new Date();
        const dichtstbij = alleDatums
          .map(d => ({ raw: d, date: new Date(d.split("/").reverse().join("-")) }))
          .filter(d => d.date >= vandaag)
          .sort((a, b) => a.date - b.date)[0];

        if (!dichtstbij) {
          document.getElementById("status").textContent = "Geen toekomstige ploegen gevonden.";
          return;
        }

        // Zoek stuk tekst rond die datum
        const zoekVenster = tekst.substring(
          tekst.indexOf(dichtstbij.raw),
          tekst.indexOf(dichtstbij.raw) + 200
        );

        document.getElementById("status").textContent = `Ploegen voor ${dichtstbij.raw}:`;
        document.getElementById("ploegen-container").innerHTML =
          "<pre>" + zoekVenster + "</pre>";
      } catch (error) {
        console.error(error);
        document.getElementById("status").textContent = "Fout bij laden PDF.";
      }
    }

    leesPDF();
  </script>
</body>
</html>
