<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Brandweer Herentals — Defectmeldingen Status</title>

<!-- PWA -->
<link rel="manifest" href="/brandweerherentals/manifest.json">
<meta name="theme-color" content="#c71f1f">

<!-- Centrale layout -->
<link rel="stylesheet" href="style.css">

<style>
/* Standaard layout behoud */
.content {
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  gap: 20px;
  padding: 20px;
  width: 100%;
}

/* Container voor grafiek */
.sheet-container {
  width: 95%;
  max-width: 1200px;
  background: #ffffff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  padding: 20px;
}

.sheet-container h2 {
  margin-top: 0;
  text-align: center;
  color: var(--red);
  font-size: 1.6rem;
  font-weight: 700;
}

/* Canvas styling */
#statusChart {
  width: 100% !important;
  max-height: 650px;
}
</style>

</head>
<body>

<div class="container">

  <!-- HEADER -->
  <header id="appHeader">
    <div class="header-left">
      <img src="/brandweerherentals/icons/logo.png" alt="Brandweer Herentals" class="header-logo">
    </div>
    <div class="header-right">
      <div id="greeting" class="header-greeting"></div>
      <div id="datetime" class="header-datetime"></div>
      <div id="ploegOfWeek" class="header-ploeg"></div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="content">

    <a href="/brandweerherentals/" class="backlink">
      <span class="arrow">←</span> Terug naar start
    </a>

    <div class="sheet-container">
      <h2>Defectmeldingen – Grafisch overzicht</h2>
      <canvas id="statusChart"></canvas>
    </div>

  </main>

  <footer>
    <div>Versie 1.1 — Status</div>
    <div></div>
  </footer>

</div>

<script src="/brandweerherentals/header.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
async function loadSheetData() {
  // URL van je gepubliceerde Google Sheet CSV
  const response = await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vQPU8cIbYtxm6jjiDUPJxufcOkCbHrKR1RJGYcjIVzfPxXvUMm-jiRpq0XMcFbiyg/pub?output=csv");
  const csvText = await response.text();
  
  // CSV parser
  const rows = csvText.split("\n").slice(1); // header overslaan
  const statusCount = {};
  
  rows.forEach(row => {
    const cols = row.split(",");
    const status = cols[2]?.trim(); // pas dit aan als status in een andere kolom staat
    if(status) {
      statusCount[status] = (statusCount[status] || 0) + 1;
    }
  });

  const ctx = document.getElementById('statusChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: Object.keys(statusCount),
      datasets: [{
        label: 'Aantal defectmeldingen',
        data: Object.values(statusCount),
        backgroundColor: 'rgba(199,31,31,0.7)'
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        title: { display: true, text: 'Defectmeldingen per status' }
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
}

loadSheetData();
</script>

</body>
</html>
