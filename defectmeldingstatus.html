<!doctype html>
<html lang="nl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Brandweer Herentals ‚Äî Defectmeldingen status</title>

<link rel="manifest" href="/brandweerherentals/manifest.json">
<meta name="theme-color" content="#c71f1f">
<link rel="stylesheet" href="style.css">

<style>

/* Zelfde basis als andere pagina's */
.content {
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:20px; 
  padding:20px;
  min-height:80vh;
}

/* Terugknop wit */
.backlink {
  display:block;
  margin-bottom:10px;
  text-decoration:none;
  color:#fff;
  font-weight:600;
}
.backlink .arrow {
  margin-right:6px;
}

/* Meldingen */
.meldingen-wrapper {
  width:100%;
  max-width:1100px;
}

.melding {
  background:#fff;
  border-radius:20px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 5px 12px rgba(0,0,0,0.15);
  transition:all 0.2s ease;
}

.melding:hover {
  transform: translateY(-2px);
  box-shadow:0 8px 18px rgba(0,0,0,0.2);
}

.row {
  display:flex;
  flex-wrap:wrap;
  gap:20px;
  margin-bottom:10px;
}

.item {
  flex:1;
  min-width:200px;
}

.label {
  font-size:0.8rem;
  color:#555;
  margin-bottom:4px;
  font-weight:600;
}

.value {
  font-size:1rem;
  font-weight:500;
  color:#111;
  white-space: pre-wrap;
  overflow-wrap: break-word;
}

/* Status pill */
.status {
  padding:6px 14px;
  border-radius:20px;
  font-size:0.75rem;
  text-transform:uppercase;
  display:inline-block;
  font-weight:700;
  letter-spacing:1px;
}

.Gemeld {
  background:#fecaca;
  color:#7f1d1d;
}

.Bezig {
  background:#fde68a;
  color:#7c2d12;
}

.Afgewerkt {
  background:#bbf7d0;
  color:#14532d;
}

.Onbekend {
  background:#e5e7eb;
  color:#374151;
}

/* Titel */
.page-title {
  color:white;
  margin-top:10px;
  margin-bottom:10px;
  font-size:1.6rem;
}

/* Loader tekst */
.loader {
  color:white;
  margin-top:20px;
  font-weight:600;
  text-align:center;
}

</style>
</head>

<body>

<div class="container">

  <!-- HEADER -->
  <header id="appHeader">
    <div class="header-left">
      <img src="/brandweerherentals/icons/logo.png" alt="Brandweer Herentals" class="header-logo">
    </div>
    <div class="header-right">
      <div id="greeting" class="header-greeting"></div>
      <div id="datetime" class="header-datetime"></div>
      <div id="ploegOfWeek" class="header-ploeg"></div>
    </div>
  </header>

  <!-- CONTENT -->
  <main class="content">

    <a href="/brandweerherentals/" class="backlink">
      <span class="arrow">‚Üê</span> Terug naar start
    </a>

    <h2 class="page-title">üìã Defectmeldingen ‚Äî Live status</h2>

    <div id="meldingen-container" class="meldingen-wrapper">
      <p class="loader">Meldingen worden geladen...</p>
    </div>

  </main>

  <footer>
    <div>Versie 1.1 ‚Äî Status</div>
  </footer>

</div>

<script src="/brandweerherentals/header.js"></script>

<script>

const SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQPU8cIbYtxm6jjiDUPJxufcOkCbHrKR1RJGYcjIVzfPxXvUMm-jiRpq0XMcFbiyg/pub?output=csv";

const container = document.getElementById("meldingen-container");


// Betere CSV parser (voor commas in zinnen)
function parseCSV(text) {
    const rows = [];
    let row = [];
    let value = '';
    let inQuotes = false;

    for (let i = 0; i < text.length; i++) {
        const char = text[i];
        const next = text[i + 1];

        if (char === '"' && inQuotes && next === '"') {
            value += '"';
            i++;
        } else if (char === '"') {
            inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
            row.push(value);
            value = '';
        } else if (char === '\n' && !inQuotes) {
            row.push(value);
            rows.push(row);
            row = [];
            value = '';
        } else {
            value += char;
        }
    }

    if (value) {
        row.push(value);
        rows.push(row);
    }

    return rows;
}


fetch(SHEET_URL)
.then(response => response.text())
.then(csvText => {

    const rows = parseCSV(csvText);
    const headers = rows.shift();

    function getIndex(name) {
        return headers.findIndex(h => h.trim().toLowerCase() === name.toLowerCase());
    }

    const naamIndex = getIndex("Naam");
    const datumIndex = getIndex("Datum");
    const omschrijvingIndex = getIndex("Defect omschrijving");
    const statusIndex = getIndex("Status");

    container.innerHTML = "";

    rows.forEach(row => {

        const naam = (row[naamIndex] || "").toString().trim();
        const datum = (row[datumIndex] || "").toString().trim();
        const omschrijving = (row[omschrijvingIndex] || "").toString().trim();
        const statusRaw = (row[statusIndex] || "").toString().trim().toLowerCase();

        if (!naam && !datum && !omschrijving && !statusRaw) return;

        let status = statusRaw || "Onbekend";
        let statusClass = "Onbekend";

        if (status.includes("gemeld")) {
            status = "Gemeld";
            statusClass = "Gemeld";
        }
        else if (status.includes("bezig") || status.includes("behandeling")) {
            status = "In behandeling";
            statusClass = "Bezig";
        }
        else if (status.includes("afgewerkt") || status.includes("opgelost")) {
            status = "Afgewerkt";
            statusClass = "Afgewerkt";
        }
        else if (!statusRaw) {
            status = "Onbekend";
        }
        else {
            status = row[statusIndex];
        }

        const melding = document.createElement("div");
        melding.classList.add("melding");

        melding.innerHTML = `
            <div class="row">
                <div class="item">
                    <div class="label">üë§ Naam</div>
                    <div class="value">${naam || "/"}</div>
                </div>

                <div class="item">
                    <div class="label">üìÖ Datum</div>
                    <div class="value">${datum || "/"}</div>
                </div>
            </div>

            <div class="row">
                <div class="item" style="flex:2">
                    <div class="label">üõ†Ô∏è Defect omschrijving</div>
                    <div class="value">${omschrijving || "/"}</div>
                </div>

                <div class="item">
                    <div class="label">üìå Status</div>
                    <span class="status ${statusClass}">${status}</span>
                </div>
            </div>
        `;

        container.appendChild(melding);
    });

    if (container.innerHTML.trim() === "") {
        container.innerHTML = "<p class='loader'>Geen meldingen gevonden</p>";
    }

})
.catch(error => {
    console.error(error);
    container.innerHTML = "<p class='loader' style='color:red'>Fout bij het laden van de gegevens</p>";
});

</script>

</body>
</html>
